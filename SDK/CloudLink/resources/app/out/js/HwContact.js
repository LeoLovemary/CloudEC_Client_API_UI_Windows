webpackJsonp([14],{101:function(t,e,r){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.HwContactSdk=void 0;var o=r(121),c=a(o),u=r(4),i=a(u),s=r(1088),d=n(s),p=r(1089),f=n(p),l=r(1092),v=n(l),h=r(1091),m=n(h),g=r(1090),C=n(g),b=r(1093),y=n(b),x=r(417),w=n(x),_=r(739),k=n(_),I=r(2122),S=n(I),E=r(1094),L=n(E),N=r(684),O=n(N),T=r(2123),A=n(T),D=r(2124),U=n(D),G=r(683),M=n(G),P=r(2125),R=n(P),$=r(2126),F=n($),B=r(2127),q=r(2129),H=n(q);e.HwContactSdk=function t(){(0,i.default)(this,t),(0,c.default)(this,v),(0,c.default)(this,m),(0,c.default)(this,C),(0,c.default)(this,y),(0,c.default)(this,f),(0,c.default)(this,w),(0,c.default)(this,k),(0,c.default)(this,S),(0,c.default)(this,L),(0,c.default)(this,d),(0,c.default)(this,O),(0,c.default)(this,A),(0,c.default)(this,U),(0,c.default)(this,M),(0,c.default)(this,R),(0,c.default)(this,F),(0,c.default)(this,B.euaserver.getApiList()),(0,c.default)(this,H)}},1088:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.transformAccountToUuid=e.goBackLastInfo=e.clickAddCustomContact=e.clickCorporateMenu=e.loadSliderDetailInfo=e.toggleSliderDetailContent=e.toggleSliderDetailShow=e.clickMenuItem=e.toggleSubMenuOpen=e.toggleSpecialMenuOpen=e.toggleMainMenuOpen=e.updateContactGroupDetailShow=e.updateSelectedItemKey=void 0;var a=r(121),o=n(a),c=r(1),u=n(c),i=r(129),s=n(i),d=r(2),p=n(d),f=r(417),l=window.Logger("logic")("contactGroups/index"),v=(e.updateSelectedItemKey=function(t){$dispatch(coreUi.updateSelectedItemKey(t))},e.updateContactGroupDetailShow=function(t){$dispatch(coreUi.updateContactGroupDetailShow(t))}),h=(e.toggleMainMenuOpen=function(){var t=(0,p.default)(u.default.mark(function t(e,r){var n,a,o,c;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,n=$getState(),a=n.contactGroups.contactMenu,o=[].concat((0,s.default)(a)),c=0;case 5:if(!(c<o.length)){t.next=12;break}if(o[c].menu_name!==e){t.next=9;break}return o[c].menu_open=r,t.abrupt("break",12);case 9:c++,t.next=5;break;case 12:return t.next=14,$dispatch(coreUi.updateContactMenuOpen(o));case 14:l.info("toggleMainMenuOpen"),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(0),l.error("toggleMainMenuOpen",t.t0);case 20:case"end":return t.stop()}},t,void 0,[[0,17]])}));return function(e,r){return t.apply(this,arguments)}}(),e.toggleSpecialMenuOpen=function(){var t=(0,p.default)(u.default.mark(function t(e,r){var n,a,o,c;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=$getState(),a=n.contactGroups.specialFocusMenu,o=[].concat((0,s.default)(a)),c=0;case 4:if(!(c<o.length)){t.next=11;break}if(o[c].id!==e){t.next=8;break}return o[c].sf_menu_open=r,t.abrupt("break",11);case 8:c++,t.next=4;break;case 11:return t.next=13,$dispatch(coreUi.updateSpecialMenuOpen(o));case 13:case"end":return t.stop()}},t,void 0)}));return function(e,r){return t.apply(this,arguments)}}()),m=(e.toggleSubMenuOpen=function(){var t=(0,p.default)(u.default.mark(function t(e,r,n){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e!==language.SPECIAL_FOCUS){t.next=6;break}return t.next=4,h(r,n);case 4:t.next=9;break;case 6:if(e!==language.CONTACTS){t.next=9;break}return t.next=9,(0,f.toggleContactTypeOpen)(r,n);case 9:l.info("切换联系人群组副目录列表折叠展开"),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),l.error("toggleSubMenuOpen",t.t0);case 15:case"end":return t.stop()}},t,void 0,[[0,12]])}));return function(e,r,n){return t.apply(this,arguments)}}(),e.clickMenuItem=function(){var t=(0,p.default)(u.default.mark(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments[1];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.contact_id){t.next=7;break}return t.next=3,(0,f.clickContact)(e);case 3:coreUi.getContactAvatar(e.account),v("contact"),t.next=11;break;case 7:if(!e.group_id){t.next=11;break}return t.next=10,coreGroup.openGroupDetailById(e.group_id);case 10:v("group");case 11:$dispatch(coreUi.updateSubmenuId(r)),$dispatch(coreUi.updateLastInfo({menuItem:e,submenuId:r})),coreGroup.initGroupAnnounceInfo();case 14:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),e.toggleSliderDetailShow=function(t){$dispatch(coreUi.updateSliderDetailShow(t))}),g=e.toggleSliderDetailContent=function(){var t=(0,p.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return $dispatch(coreUi.updateSliderDetailContent(e)),t.next=3,$dispatch(coreUi.updateSliderDetailLoading(!1));case 3:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),C=(e.loadSliderDetailInfo=function(){var t=(0,p.default)(u.default.mark(function t(e){var r,n,a,c,i,s,d,p,v,h,b,y,x,w,_,k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=$getState(),n=r.contactGroups.sliderDetailShow,t.next=5,C();case 5:return t.next=7,$dispatch(coreUi.updateSliderDetailLoading(!0));case 7:if(coreUi.showSearchPanel(!1),isNullOrEmpty(e.group_id)||!isNullOrEmpty(e.account)){t.next=37;break}if(!isNullOrEmpty(e.recent)){t.next=29;break}return t.next=12,coreGroup.getGroupDetailInfo(e);case 12:return a=t.sent,c=a.groupId,i=a.groupInfoNew,s=a.groupMemberInfo,d=a.isOwner,p=a.groupSetting,t.next=20,$dispatch(coreUi.updateSliderGroupDetail(i,s,p,d));case 20:return t.next=22,g(constant.SLIDER_DETAIL_TYPE.group);case 22:return t.next=24,coreGroup.initGroupAnnounceInfo();case 24:if(n){t.next=27;break}return t.next=27,m(!0);case 27:t.next=35;break;case 29:return t.next=31,m(!1);case 31:return coreIm.toggleRecent(e.recent),coreUi.openGroupDetail(e.recent.group),t.next=35,$dispatch(coreUi.updateSliderDetailLoading(!1));case 35:t.next=69;break;case 37:return v=isNullOrEmpty(e.account),t.next=40,coreDb.queryContact({all:"",accountlist:e.account});case 40:return h=t.sent,b=isNullOrEmpty(h)?e:h,t.next=44,$dispatch(coreUi.updateSliderContactDetail(b,v,k));case 44:return t.next=46,g(constant.SLIDER_DETAIL_TYPE.contact);case 46:if(n){t.next=49;break}return t.next=49,m(!0);case 49:return t.next=51,(0,f.getContactDetailInfo)(e,!0);case 51:if(y=t.sent,x=y.userInfo,w=y.customContact,!0!==x.isNotServerInfo){t.next=66;break}if($getState().login.deployMode!==constant.MEETING_NET_TYPE.SMC_MEETING){t.next=63;break}return l.info("user not found,search by sip"),t.next=59,coreContact.queryServerContact(e.account);case 59:_=t.sent,isNullOrEmpty(_)||isNullOrEmpty(_.param)?x=(0,o.default)({},e,{isNotServerInfo:!0}):(l.info("search userInfo by sip success"),x=_.param),t.next=64;break;case 63:x=(0,o.default)({},e,{isNotServerInfo:!0});case 64:t.next=67;break;case 66:x.isNotServerInfo=!1;case 67:return t.next=69,$dispatch(coreUi.updateSliderContactDetail(x,w,k));case 69:l.info("加载弹窗联系人或群组详情"),t.next=75;break;case 72:t.prev=72,t.t0=t.catch(0),l.error("loadSliderDetailInfo",t.t0);case 75:case"end":return t.stop()}},t,void 0,[[0,72]])}));return function(e){return t.apply(this,arguments)}}(),function(){var t=(0,p.default)(u.default.mark(function t(){var e,r;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=$getState(),!(r=e.call.callStatus)){t.next=5;break}return l.info("toggle call page when open detail"),t.next=5,coreCall.setNoMoveTrue();case 5:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}());e.clickCorporateMenu=function(){var t=(0,p.default)(u.default.mark(function t(e,r){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:v(e),$dispatch(coreUi.updateSubmenuId(r)),$dispatch(coreUi.updateLastInfo({menuItem:e,submenuId:r}));case 3:case"end":return t.stop()}},t,void 0)}));return function(e,r){return t.apply(this,arguments)}}(),e.clickAddCustomContact=function(){var t=(0,p.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:v(e);case 1:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.goBackLastInfo=function(){var t=(0,p.default)(u.default.mark(function t(){var e,r;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=$getState().contactGroups.lastContactGroupInfo,r=void 0===e?{}:e,!r.menuItem.contact_id){t.next=7;break}return t.next=4,(0,f.clickContact)(r.menuItem);case 4:v("contact"),t.next=14;break;case 7:if(!r.menuItem.group_id){t.next=13;break}return t.next=10,coreGroup.openGroupDetailById(r.menuItem.group_id);case 10:v("group"),t.next=14;break;case 13:v(r.menuItem);case 14:$dispatch(coreUi.updateSubmenuId(r.submenuId));case 15:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),e.transformAccountToUuid=function(){var t=(0,p.default)(u.default.mark(function t(e){var r,n,a,o;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!coreAccount.getLoginModel().isSupportAS){t.next=18;break}return t.next=3,coreDb.queryContactList({account:e});case 3:if(r=t.sent,""===(n=isNullOrEmpty(r)?"":r[0].uuid)){t.next=10;break}return l.info("transformAccountToUuid dbuuid",n),t.abrupt("return",n);case 10:return t.next=12,coreContact.searchServerContact(e);case 12:return a=t.sent,o=isNullOrEmpty(a)?"":a.userInformationList[0].id,l.info("transformAccountToUuid euauuid",o),t.abrupt("return",o);case 16:t.next=19;break;case 18:return t.abrupt("return",e);case 19:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}()},1089:function(t,e,r){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0}),e.post=e.getHeaders=e.uploadAvatar=e.setSign=e.removeEventListenerDealKeyBoard=e.addEventListenerDealKeyBoard=e.modifyCustomContact=e.openEditCustomPage=e.checkIsChange=e.updataEditStatus=e.checkEmailInput=e.mHandleChangeCustomResult=e.updataCustomDucks=e.searchContactByNum=e.addCustomContact=e.getRecentContactList=e.getFriendList=e.dealContactGroupInfo=e.addContactToContactGroup=e.saveContactInfoList=e.saveContactInfo=void 0;var a=r(2120);Object.defineProperty(e,"setSign",{enumerable:!0,get:function(){return a.setSign}}),Object.defineProperty(e,"uploadAvatar",{enumerable:!0,get:function(){return a.uploadAvatar}}),Object.defineProperty(e,"getHeaders",{enumerable:!0,get:function(){return a.getHeaders}}),Object.defineProperty(e,"post",{enumerable:!0,get:function(){return a.post}});var o=r(1090),c=n(o),u=r(1091),i=n(u),s=r(1092),d=n(s),p=r(2121),f=r(1093),l=n(f);e.saveContactInfo=p.saveContactInfo,e.saveContactInfoList=p.saveContactInfoList;e.addContactToContactGroup=i.addContactToContactGroup,e.dealContactGroupInfo=i.dealContactGroupInfo,e.getFriendList=c.getFriendList,e.getRecentContactList=c.getRecentContactList,e.addCustomContact=d.addCustomContact,e.searchContactByNum=d.searchContactByNum,e.updataCustomDucks=d.updataCustomDucks,e.mHandleChangeCustomResult=d.mHandleChangeCustomResult,e.checkEmailInput=d.checkEmailInput,e.updataEditStatus=d.updataEditStatus,e.checkIsChange=d.checkIsChange,e.openEditCustomPage=d.openEditCustomPage,e.modifyCustomContact=d.modifyCustomContact,e.addEventListenerDealKeyBoard=l.addEventListenerDealKeyBoard,e.removeEventListenerDealKeyBoard=l.removeEventListenerDealKeyBoard},1090:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=window.Logger("logic")("contactGroup/contact/dealData");e.getRecentContactList=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var e=$getState(),r=e.myInfo,a=e.recent.recentList,o=t.filterContacts,c=void 0===o?[]:o;return n.info("getRecentContactList"),a.filter(function(t){return!coreIm.isGroup(t.chat_type)&&!isNullOrEmpty(t.contact)&&t.contact.account!==r.account&&isNullOrEmpty(c.query({account:t.account}))}).map(function(t){return t.contact})}catch(t){n.error("getRecentContactList",t)}},e.getFriendList=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var e=$getState(),r=e.myInfo,a=e.contactGroups.contactUserList,o=t.filterContacts,c=void 0===o?[]:o;return n.info("getFriendList"),a.filter(function(t){return t.account!==r.account&&isNullOrEmpty(c.query({account:t.account}))})}catch(t){n.error("getFriendList",t)}}},1091:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(){var t=$getState(),e=t.contactGroups.contactUserList,r=parseInt(window.CLIENTCONFIG["Device.ComCfg.IM.MaxContact"]);if(isNaN(r))return window.alert(window.language.ADD_FRIEND_ERROR),C.error("checkNowFriendNum esight config IM.MaxContact error"),!1;var n=e?e.length:0;return n>=r?(window.alert(window.language.ADD_TO_MAX),!1):n<r}Object.defineProperty(e,"__esModule",{value:!0}),e.dealContactGroupInfo=e.normalAddContactToContactGroup=e.addContactToContactGroup=void 0;var o=r(144),c=n(o),u=r(1),i=n(u),s=r(2),d=n(s),p=(e.addContactToContactGroup=function(){var t=(0,d.default)(i.default.mark(function t(e){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(C.info("addContactToContactGroup add a contact as a friend"),e&&e.account){t.next=5;break}if(!window.CLIENTCONFIG.USE_IM){t.next=5;break}return C.info("addContactToContactGroup contact information has a problem or no account"),t.abrupt("return");case 5:if(a()){t.next=7;break}return t.abrupt("return");case 7:return t.abrupt("return",window.CLIENTCONFIG.USE_IM?b(e):p(e));case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),function(){var t=(0,d.default)(i.default.mark(function t(e){var r,n=this;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.delegateYield(i.default.mark(function t(){var r,a,o,c,u,s,d,p,f,v,m,b,y;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return C.info("teAddContactToContactGroup add a contact as a friend"),t.next=3,l();case 3:if(r=t.sent,e.id){t.next=9;break}return t.next=7,coreDb.queryContact({account:e.account});case 7:a=t.sent,isNullOrEmpty(a)||(e=a);case 9:for(o=$getState(),c=o.contactGroups.contactUserList,u=1;-1!==c.findIndex(function(t){return parseInt(t.contact_id)===u});)u++;return e.contact_id=u.toString(),t.next=16,coreContact.saveContactInfo(e);case 16:return e=t.sent,s={contact_id:e.contact_id,group_id:r.group_id,state:constant.CONTACT_STATE.ADD},t.next=20,coreDb.saveContactMemberGroup(s);case 20:return t.next=22,(0,g.reloadContactListData)();case 22:if(d=o.contactGroups,p=d.detailContent,f=d.contactInfo,v=d.sliderDetailShow,m=d.sliderContent,b=d.sliderContactInfo,!v||"Contact"!==m||b.account!==e.account){t.next=26;break}return t.next=26,$dispatch(coreUi.updateSliderContactDetail(e,!1));case 26:if("contact"!==p||f.account!==e.account&&f.contact_id!==e.contact_id||$dispatch(coreUi.updateContactDetail(e,!1)),!window.CLIENTCONFIG.ISMOBILE){t.next=35;break}if($dispatch(coreUi.updateMobileContactDetail(e,!1)),window.Toast(language.ADDED_FRIEND,2,!1),window.CLIENTCONFIG.USE_IM){t.next=32;break}return t.abrupt("return",{v:void 0});case 32:return y={account:e.account,contact_id:e.contact_id},t.next=35,(0,h.tapContact)(y);case 35:case"end":return t.stop()}},t,n)})(),"t0",2);case 2:if(r=t.t0,"object"!==(void 0===r?"undefined":(0,c.default)(r))){t.next=5;break}return t.abrupt("return",r.v);case 5:t.next=10;break;case 7:t.prev=7,t.t1=t.catch(0),C.error("teAddContactToContactGroup",t.t1.toJSON);case 10:case"end":return t.stop()}},t,this,[[0,7]])}));return function(e){return t.apply(this,arguments)}}()),f=e.dealContactGroupInfo=function(){var t=(0,d.default)(i.default.mark(function t(){var e,r,n,a,o,c,u;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=$getState(),r=void 0,n=e.contactGroups.contactGroup,a="Group",-1!==(o=n.findIndex(function(t){return t.name===a}))){t.next=14;break}return t.next=7,(0,v.addContactGroupService)(a,n.length);case 7:return c=t.sent,u={group_id:c.param.id,index:n.length,name:a,state:0},t.next=11,coreDb.saveContactGroup(u);case 11:r={group_id:c.param.id,index:n.length},t.next=15;break;case 14:r={group_id:n[o].group_id,index:o};case 15:return t.abrupt("return",r);case 16:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),l=function(){var t=(0,d.default)(i.default.mark(function t(){var e,r,n,a,o,c=this;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=$getState(),r=void 0,n=e.contactGroups.contactGroup,a="Group",-1!==(o=n.findIndex(function(t){return t.name===a}))){t.next=8;break}return t.delegateYield(i.default.mark(function t(){var e,o;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(e=1;-1!==n.findIndex(function(t){return t.group_id===e});)e++;return o={group_id:e,index:n.length,name:a,state:0},t.next=5,coreDb.saveContactGroup(o);case 5:r={group_id:e,index:n.length};case 6:case"end":return t.stop()}},t,c)})(),"t0",6);case 6:t.next=9;break;case 8:r={group_id:n[o].group_id,index:o};case 9:return t.abrupt("return",r);case 10:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),v=r(683),h=r(684),m=r(739),g=r(417),C=window.Logger("logic")("contact"),b=e.normalAddContactToContactGroup=function(){var t=(0,d.default)(i.default.mark(function t(e){var r,n,a,o,c,u,s,d,p,l,b,y,x,w;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,C.info("normalAddContactToContactGroup add a contact as a friend"),t.next=4,f();case 4:return r=t.sent,n={account:e.account,group_id:r.group_id,display_name:""},t.next=8,(0,v.addContactService)(n);case 8:if(a=t.sent,a.result!==constant.ERROR_CODE.Success){t.next=47;break}if(e.id){t.next=15;break}return t.next=13,coreDb.queryContact({all:"",accountlist:e.account});case 13:o=t.sent,isNullOrEmpty(o)||(e=o);case 15:return e.contact_id=a.param.contact_id,t.next=18,(0,m.deleteContactPreSave)(e.account);case 18:return t.next=20,coreContact.saveContactInfo(e);case 20:return e=t.sent,c={contact_id:e.contact_id,group_id:r.group_id,state:constant.CONTACT_STATE.ADD},t.next=24,coreDb.saveContactMemberGroup(c);case 24:return t.next=26,(0,g.reloadContactListData)();case 26:if(u=$getState(),s=u.contactGroups,d=s.detailContent,p=s.contactInfo,l=s.sliderDetailShow,b=s.sliderContent,y=s.sliderContactInfo,!l||"Contact"!==b||y.account!==e.account){t.next=31;break}return t.next=31,$dispatch(coreUi.updateSliderContactDetail(e,!1));case 31:if("contact"!==d||p.account!==e.account&&p.contact_id!==e.contact_id||$dispatch(coreUi.updateContactDetail(e,!1)),!window.CLIENTCONFIG.ISMOBILE){t.next=37;break}return $dispatch(coreUi.updateMobileContactDetail(e,!1)),x={account:e.account,contact_id:e.contact_id},t.next=37,(0,h.tapContact)(x);case 37:return t.next=39,coreIm.getLocalRecent({owner:e.account});case 39:if(w=t.sent,isNullOrEmpty(w)){t.next=46;break}return w.contact=e,t.next=44,coreDb.saveRecent(w);case 44:w=t.sent,$dispatch(coreUi.updateRecent(w));case 46:return t.abrupt("return",a.result);case 47:t.next=52;break;case 49:t.prev=49,t.t0=t.catch(0),C.error("normalAddContactToContactGroup",t.t0.toJSON);case 52:case"end":return t.stop()}},t,void 0,[[0,49]])}));return function(e){return t.apply(this,arguments)}}()},1092:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(){var t=$getState(),e=t.contactGroups.contactUserList,r=parseInt(window.CLIENTCONFIG["Device.ComCfg.IM.MaxContact"]);if(isNaN(r))return window.alert(window.language.ADD_FRIEND_ERROR),x.error("checkNowFriendNum esight config IM.MaxContact error"),!1;var n=e?e.length:0;return n>=r?(window.alert(window.language.ADD_TO_MAX),!1):n<r}Object.defineProperty(e,"__esModule",{value:!0}),e.searchContactByNum=e.checkIsChange=e.checkEmailInput=e.mHandleChangeCustomResult=e.openEditCustomPage=e.updataEditStatus=e.updataCustomDucks=e.delCustomContact=e.modifyCustomContact=e.addCustomContact=void 0;var o=r(131),c=n(o),u=r(121),i=n(u),s=r(144),d=n(s),p=r(1),f=n(p),l=r(2),v=n(l),h=function(){var t=(0,v.default)(f.default.mark(function t(){var e,r,n,a,o,c=this;return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=$getState(),r=void 0,n=e.contactGroups.contactGroup,a="Group",-1!==(o=n.findIndex(function(t){return t.name===a}))){t.next=8;break}return t.delegateYield(f.default.mark(function t(){var e,o;return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(e=1;-1!==n.findIndex(function(t){return t.group_id===e});)e++;return o={group_id:e,index:n.length,name:a,state:0},t.next=5,coreDb.saveContactGroup(o);case 5:r={group_id:e,index:n.length};case 6:case"end":return t.stop()}},t,c)})(),"t0",6);case 6:t.next=9;break;case 8:r={group_id:n[o].group_id,index:o};case 9:return t.abrupt("return",r);case 10:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),m=r(683),g=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(m),C=r(417),b=(r(684),r(1089)),y=r(1088),x=window.Logger("logic")("addCustom"),w=(e.addCustomContact=function(){var t=(0,v.default)(f.default.mark(function t(e){return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(x.info("addCustomContact add custom contact to contact group"),a()){t.next=3;break}return t.abrupt("return");case 3:return t.abrupt("return",window.CLIENTCONFIG.USE_IM?w(e):_(e));case 4:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),function(){var t=(0,v.default)(f.default.mark(function t(e){var r,n,a;return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,x.info("normalAddCustomContact begin"),!window.CLIENTCONFIG.ISMOBILE){t.next=8;break}if(e.hasOwnProperty("group_id")){t.next=8;break}return t.next=6,(0,b.dealContactGroupInfo)();case 6:r=t.sent,e.group_id=r.group_id;case 8:return t.next=10,g.addCustomContactService(e);case 10:if(n=t.sent,n.result!==constant.RESULT.SUCCESS||1!==n.param.result){t.next=21;break}return e.contact_id=n.param.contact_id,t.next=15,coreContact.saveContactInfo(e);case 15:return e=t.sent,a={contact_id:e.contact_id,group_id:e.group_id,state:constant.CONTACT_STATE.ADD},t.next=19,coreDb.saveContactMemberGroup(a);case 19:return t.next=21,(0,C.reloadContactListData)();case 21:return t.abrupt("return",{result:n.result});case 24:return t.prev=24,t.t0=t.catch(0),x.error("normalAddCustomContact error",t.t0),t.abrupt("return",{result:1});case 28:case"end":return t.stop()}},t,void 0,[[0,24]])}));return function(e){return t.apply(this,arguments)}}()),_=function(){var t=(0,v.default)(f.default.mark(function t(e){var r;return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.delegateYield(f.default.mark(function t(){var r,n,a,o,c;return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return x.info("TeAddCustomContact begin"),t.next=3,h();case 3:for(r=t.sent,n=$getState(),a=n.contactGroups.contactUserList,o=1;-1!==a.findIndex(function(t){return parseInt(t.contact_id)===o});)o++;return e.contact_id=o.toString(),e.gender=2,t.next=12,coreContact.saveContactInfo(e);case 12:return e=t.sent,c={contact_id:e.contact_id,group_id:r.group_id,state:constant.CONTACT_STATE.ADD},t.next=16,coreDb.saveContactMemberGroup(c);case 16:return t.next=18,(0,C.reloadContactListData)();case 18:return t.abrupt("return",{v:{result:0}});case 19:case"end":return t.stop()}},t,void 0)})(),"t0",2);case 2:if(r=t.t0,"object"!==(void 0===r?"undefined":(0,d.default)(r))){t.next=5;break}return t.abrupt("return",r.v);case 5:t.next=10;break;case 7:t.prev=7,t.t1=t.catch(0),x.error("TeAddCustomContact",t.t1.toJSON);case 10:case"end":return t.stop()}},t,void 0,[[0,7]])}));return function(e){return t.apply(this,arguments)}}(),k=(e.modifyCustomContact=function(){var t=(0,v.default)(f.default.mark(function t(e){return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return x.info("modifyCustomContact modify custom info"),t.abrupt("return",window.CLIENTCONFIG.USE_IM?k(e):I(e));case 2:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),function(){var t=(0,v.default)(f.default.mark(function t(e){var r,n,a,o;return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,x.info("modifyCustomContact begin"),r=$getState().contactGroups.lastContactGroupInfo,n=void 0===r?{}:r,a={},t.next=6,g.modifyCustomContactService(e);case 6:if(o=t.sent,o.result!==constant.RESULT.SUCCESS||1!==o.param.result){t.next=15;break}return t.next=10,coreContact.saveContactInfo(e);case 10:return e=t.sent,t.next=13,(0,C.reloadContactListData)();case 13:$dispatch(coreUi.updateSliderContactDetail(e,!0)),!isNullOrEmpty(n)&&n.menuItem&&n.menuItem.contact_id===e.contact_id&&(a=(0,i.default)({},n,{menuItem:e}),$dispatch(coreUi.updateLastInfo(a)));case 15:return t.abrupt("return",{result:o.result});case 18:t.prev=18,t.t0=t.catch(0),x.error("normalModifyCustomContact error",t.t0);case 21:case"end":return t.stop()}},t,void 0,[[0,18]])}));return function(e){return t.apply(this,arguments)}}()),I=function(){var t=(0,v.default)(f.default.mark(function t(e){var r,n,a;return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,x.info("TeModifyCustomContact begin"),r=$getState().contactGroups.lastContactGroupInfo,n=void 0===r?{}:r,a={},t.next=6,coreContact.saveContactInfo(e);case 6:return e=t.sent,t.next=9,(0,C.reloadContactListData)();case 9:return $dispatch(coreUi.updateSliderContactDetail(e,!0)),!isNullOrEmpty(n)&&n.menuItem&&n.menuItem.contact_id===e.contact_id&&(n.menuItem=e,a=(0,i.default)({},n,{menuItem:e}),$dispatch(coreUi.updateLastInfo(a))),t.abrupt("return",{result:0});case 14:t.prev=14,t.t0=t.catch(0),x.error("TeModifyCustomContact",t.t0.toJSON);case 17:case"end":return t.stop()}},t,void 0,[[0,14]])}));return function(e){return t.apply(this,arguments)}}(),S=(e.delCustomContact=function(){var t=(0,v.default)(f.default.mark(function t(e){return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case 1:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.updataCustomDucks=function(t){$dispatch(coreUi.updateCustomInfo(t))});e.updataEditStatus=function(t){$dispatch(coreUi.changeCustomEditStatus(t))},e.openEditCustomPage=function(t){if(t.contact_id&&(t.isModify=!0),S(t),window.CLIENTCONFIG.ISMOBILE)return window.goRoute("newCustomContact"),void x.info("openEditCustomPage current client is mobile");window.goRoute("main/contactGroups"),(0,y.clickAddCustomContact)("addCustom")},e.mHandleChangeCustomResult=function(t){if(!window.CLIENTCONFIG.ISMOBILE)return void x.info("mHandleChangeCustomResult current client is pc");S({}),window.history.back(),$dispatch(coreUi.updateMobileContactDetail(t,isNullOrEmpty(t.account)))},e.checkEmailInput=function(t){var e=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;return!!isNullOrEmpty(t)||e.test(t)},e.checkIsChange=function(t,e){if("object"!==Object.type(t)||"object"!==Object.type(e))return!1;var r=!1;return(0,c.default)(t).forEach(function(n){e.hasOwnProperty(n)?t[n]!==e[n]&&(r=!0):r=!0}),r},e.searchContactByNum=function(){var t=(0,v.default)(f.default.mark(function t(){var e,r,n,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e={},t.next=3,coreDb.queryContactByPhonenumberAccurate(a);case 3:if(r=t.sent,isNullOrEmpty(r)){t.next=10;break}x.info("searchContactByNum find constact in DB success"),e=r[0],r.length>1&&r.forEach(function(t){""===t.account&&(e=t)}),t.next=15;break;case 10:return x.info("searchContactByNum  not find in DB, query contact from server"),t.next=13,coreContact.queryServerContact(a);case 13:n=t.sent,n&&n.param&&(e=n.param);case 15:return t.abrupt("return",e);case 16:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}()},1093:function(t,e,r){"use strict";function n(){coreCommon.isIos()&&(c.info("addEventListenerDealKeyBoard 添加键盘变化事件"),window.removeEventListener("keyBoardChange",o),window.addEventListener("keyBoardChange",o))}function a(){coreCommon.isIos()&&(c.info("removeEventListenerDealKeyBoard 去除键盘变化事件"),window.removeEventListener("keyBoardChange",o))}function o(t){try{c.debug("键盘Change");var e=t.data,r=e.kbWidth,n=e.changeHeight,a=e.kbHeight,o=document.querySelector(".mobile-add-custom-others");if(o){if(n-a==0)return c.info("键盘Change 键盘落下"),void(o.style.marginBottom=null);c.info("键盘Change 键盘不落下");o.style.marginBottom=a*window.innerWidth/r-0+"px"}}catch(t){c.error("键盘Change",t.toString())}}Object.defineProperty(e,"__esModule",{value:!0}),e.addEventListenerDealKeyBoard=n,e.removeEventListenerDealKeyBoard=a;var c=window.Logger("logic")("addCustom/dealIosKeyBoardChange")},1094:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.coverUserList=e.queryUsersIncrementFromEaddr=e.queryAllfromList=e.deleteContactFromDB=e.getLocalContactAndGroupInfo=e.teLoadContactAndGroupList=e.normalLoadContactAndGroupList=void 0;var a=r(144),o=n(a),c=r(129),u=n(c),i=r(143),s=n(i),d=r(121),p=n(d),f=r(1),l=n(f),v=r(3),h=n(v),m=r(2),g=n(m),C=(e.normalLoadContactAndGroupList=function(){var t=(0,g.default)(l.default.mark(function t(){var e,r;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=coreAccount.getLoginModel(),e.useIM){t.next=4;break}return E.info("normalLoadContactAndGroupList","now is te eva"),t.abrupt("return");case 4:return t.next=6,k.getContactList();case 6:return r=t.sent,t.next=9,E.info("uc get contactList and groupList from eserver result : ",r.result);case 9:if(!r){t.next=12;break}return t.next=12,h.default.all([N(r.param),coreGroup.calGroupAndMemberListData(r.param)]);case 12:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),e.teLoadContactAndGroupList=function(){var t=(0,g.default)(l.default.mark(function t(){var e,r;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=coreAccount.getLoginModel(),!e.useIM){t.next=4;break}return E.info("teLoadContactAndGroupList","now is uc eva"),t.abrupt("return");case 4:return E.debug("teLoadContactAndGroupList TE模式 获取联系人和群组"),t.next=7,L();case 7:r=t.sent,C(r&&r.contactUserList);case 9:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),function(){var t=(0,g.default)(l.default.mark(function t(e){var r,n,a,o,c,u,i,s,d;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,E.info("updataTeContactInfo begin!"),!isNullOrEmpty(e)){t.next=5;break}return E.error("updataTeContactInfo contactList is empty!"),t.abrupt("return");case 5:return r=[],n=e.getKeyArr("account"),coreUi.getContactListAvatar(n),a=e.map(function(t){if(""!==t.account)return{username:t.account,etag:""===t.etag?"fffff":t.etag}}),o=[],c=coreAccount.getLoginModel().isSupportAS?200:20,a.splitByNum(c).forEach(function(t){r.push(coreContact.queryUserListFromEaddr(t))}),t.next=14,h.default.all(r).then(function(t){t.forEach(function(t){0===t.result&&t.entry.forEach(function(t){t.result_code===constant.EADDR_CONTACT_RESULT_CODE.SUCCESS&&o.push(t)})})});case 14:if(!isNullOrEmpty(o)){t.next=17;break}return E.info("updataTeContactInfo contact info already newest!"),t.abrupt("return");case 17:if(u=e.map(function(t){var e=o.query({account:t.account});return isNullOrEmpty(e)?t:(0,p.default)({},t,e)}),coreContact.saveContactInfoList(u),$dispatch(coreUi.updateContactListData({contactUserList:u})),!window.CLIENTCONFIG.ISMOBILE){t.next=27;break}return t.next=23,(0,I.sortMUserList)(u);case 23:i=t.sent,s=i.mList,d=i.enList,$dispatch(coreUi.updateMobileContactList(s,d));case 27:t.next=32;break;case 29:t.prev=29,t.t0=t.catch(0),E.error("updataTeContactInfo error",t.t0);case 32:case"end":return t.stop()}},t,this,[[0,29]])}));return function(e){return t.apply(this,arguments)}}()),b=function(){var t=(0,g.default)(l.default.mark(function t(e,r){var n,a,o,c,u,i,s,d,p,f;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(E.info("好友列表 begin"),!isNullOrEmpty(e)){t.next=4;break}return E.info("dealContactInfo recordList is empty"),t.abrupt("return",[]);case 4:
//! 操作记录去重
return n=[],a=[],o=U(e),t.next=9,y(o);case 9:if(c=t.sent,u=G(c,r),i=u.getKeyArr("account"),s=i.join(","),i.splitByNum(20).forEach(function(t){coreUi.getContactListAvatar(t)}),isNullOrEmpty(s)){t.next=21;break}return t.next=17,coreDb.queryContactList({all:"",accountlist:s});case 17:return d=t.sent,d.forEach(function(t){n.push(coreDb.deleteContact({id:""+t.id}))}),t.next=21,h.default.all(n);case 21:return t.next=23,M(u);case 23:return p=t.sent,f=P(u,p),f.forEach(function(t){t.state===constant.CONTACT_STATE.ADD&&(t.contact_id=t.id),delete t.id,a.push(t)}),E.info("dealContactInfo success! data length:"+a.length),t.abrupt("return",a);case 28:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}(),y=function(){var t=(0,g.default)(l.default.mark(function t(){var e,r,n,a,o,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!isNullOrEmpty(c)){t.next=3;break}return E.info("dealCustomContact contactList is empty"),t.abrupt("return",[]);case 3:e=[],r=[],n=0;case 6:if(!(n<c.length)){t.next=23;break}if(a=c[n],!isNullOrEmpty(a.account)||a.state!==constant.CONTACT_STATE.ADD){t.next=12;break}e.push(a),t.next=20;break;case 12:if(!isNullOrEmpty(a.account)||a.state!==constant.CONTACT_STATE.DELETE){t.next=19;break}return t.next=15,coreDb.queryContactByContactId(a.id);case 15:o=t.sent,!isNullOrEmpty(o)&&r.push(coreDb.deleteContact({id:o.id})),t.next=20;break;case 19:e.push(a);case 20:n++,t.next=6;break;case 23:return t.next=25,h.default.all(r);case 25:return t.abrupt("return",e);case 26:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),x=function(){var t=(0,g.default)(l.default.mark(function t(e){var r,n,a,o,c;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(E.info("dealContactGroupInfo"),e=e||[],e.length){t.next=4;break}return t.abrupt("return",[]);case 4:r=[],n=[],a=0;case 7:if(!(a<e.length)){t.next=25;break}if(o=e[a],o.state!==constant.CONTACT_STATE.ADD){t.next=20;break}if("Group"!==o.name){t.next=15;break}return t.next=13,coreDb.queryAllContactGroupList();case 13:c=t.sent,c.forEach(function(t){"Group"===t.name&&(n.push(coreDb.deleteContactGroup({group_id:t.group_id})),n.push(coreDb.deleteContactMemberGroup({group_id:t.group_id})))});case 15:o.group_id=o.id,delete o.id,r.push(o),t.next=22;break;case 20:n.push(coreDb.deleteContactGroup({group_id:o.id})),n.push(coreDb.deleteContactMemberGroup({group_id:o.id}));case 22:a++,t.next=7;break;case 25:return t.next=27,h.default.all(n);case 27:return r=O(r),t.abrupt("return",r);case 29:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),w=function(){var t=(0,g.default)(l.default.mark(function t(e){var r,n;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(E.debug("dealContactGroupMemberList"),e=e||[],e.length){t.next=4;break}return t.abrupt("return",[]);case 4:return r=[],n=[],e.forEach(function(t){t.state===constant.CONTACT_STATE.ADD?r.push(t):n.push(coreDb.deleteContactMemberGroup({group_id:t.group_id,contact_id:t.contact_id}))}),t.next=9,h.default.all(n);case 9:return t.abrupt("return",r);case 10:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),_=r(683),k=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(_),I=r(684),S=r(739),E=window.Logger("logic")("contactGroup/联系人群组增量处理"),L=e.getLocalContactAndGroupInfo=function(){var t=(0,g.default)(l.default.mark(function t(){var e,r,n,a,o,c,u,i,d;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!window.CLIENTCONFIG.ENABLE_IT_MEETING){t.next=2;break}return t.abrupt("return");case 2:return E.debug("getLocalContactAndGroupInfo"),t.next=5,h.default.all([coreDb.queryAllContact(),coreDb.queryAllContactGroupList(),coreDb.queryAllContactMemberGroupList()]);case 5:if(e=t.sent,r=(0,s.default)(e,3),n=r[0],a=r[1],o=r[2],c={hasContact:n.length>0,contactUserList:n,contactGroup:a,contactMemberGroup:o},$dispatch(coreUi.updateContactListData(c)),T(n),!window.CLIENTCONFIG.ISMOBILE){t.next=20;break}return t.next=16,(0,I.sortMUserList)(n);case 16:u=t.sent,i=u.mList,d=u.enList,$dispatch(coreUi.updateMobileContactList(i,d));case 20:return A(),t.abrupt("return",c);case 22:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),N=function(){var t=(0,g.default)(l.default.mark(function t(e){var r,n,a,o,c,u,i,d,p;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,E.info("calcContactListData deal contactList"),r=e.contact_list,n=e.user_list,a=e.user_group_list,o=e.user_group_member_list,t.next=5,h.default.all([coreAccount.getLoginModel().isSupportAS?$(r):b(r,n),x(a),w(o)]);case 5:return c=t.sent,u=(0,s.default)(c,3),i=u[0],d=u[1],p=u[2],E.info("整理联系人列表数据","success"),t.next=13,h.default.all([coreContact.saveContactInfoList(i),coreDb.bulkPutContactGroup(d),coreDb.bulkPutContactMemberGroup(p)]);case 13:return t.next=15,L();case 15:return t.abrupt("return",t.sent);case 18:t.prev=18,t.t0=t.catch(0),E.error("calcContactListData",t.t0);case 21:case"end":return t.stop()}},t,void 0,[[0,18]])}));return function(e){return t.apply(this,arguments)}}(),O=function(t){return t=t||[],t.sort(function(t,e){return t.group_id>e.group_id})},T=function(t){E.debug("dealSpecialContacts 筛选特别关注联系人");var e=[];t&&t.length>0&&t.forEach(function(t){t.isSpecial&&e.push(t)}),$dispatch(coreUi.updateSpecialContactListData(e))},A=function(){try{E.debug("loadContactTypeOpen 加载与刷新联系人分组折叠对应表");var t=$getState(),e=t.contactGroups.contactGroup,r=t.contactGroups.contactTypeOpen,n=[].concat((0,u.default)(e)),a=[].concat((0,u.default)(r));if(0===r.length)n.forEach(function(t){a.push({group:t.group_id,open:!1})});else{var o=[],c=[];a.forEach(function(t){c.push(t.group)}),n.forEach(function(t){a.forEach(function(e){t.group_id===e.group?o.push({group:t.group_id,open:e.open}):-1===c.indexOf(t.group_id)&&o.push({group:t.group_id,open:!1})})}),a=[].concat(o)}E.info("loadContactTypeOpen 加载刷新联系人分组折叠表","success"),$dispatch(coreUi.updateContactTypeOpen(a))}catch(t){E.error("loadContactTypeOpen",t)}},D=(e.deleteContactFromDB=function(){var t=(0,g.default)(l.default.mark(function t(e){return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!isNullOrEmpty(e)){t.next=3;break}return E.debug("deleteContact data null"),t.abrupt("return",{});case 3:if(!e.id){t.next=11;break}return t.next=6,coreDb.deleteContact({id:e.id});case 6:if(""===e.account){t.next=9;break}return t.next=9,coreContact.saveContactInfo(e);case 9:t.next=11;break;case 11:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),function(){var t=(0,g.default)(l.default.mark(function t(e){var r,n,a;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r="",n=[],isNullOrEmpty(e)){t.next=15;break}return r=e.getKeyArr("account").join(","),t.next=7,coreDb.queryContactList({all:"",accountlist:r});case 7:if(t.t0=t.sent,t.t0){t.next=10;break}t.t0=[];case 10:return a=t.t0,e.forEach(function(t){for(var e=D(a,{account:t.account}),r=0;r<e.length;r++){var o=e[r];n.push(coreDb.deleteContact({id:""+o.id}))}}),t.next=14,h.default.all(n);case 14:E.info("delDbContactList success");case 15:t.next=20;break;case 17:t.prev=17,t.t1=t.catch(0),E.error("delDbContactList fail",{error:t.t1.toJSON()});case 20:case"end":return t.stop()}},t,void 0,[[0,17]])}))}(),e.queryAllfromList=function(t,e){try{var r=function(){var r=[];for(var n in e)!function(n){t.forEach(function(t){e[n]===t[n]&&r.push(t)})}(n);return{v:r}}();if("object"===(void 0===r?"undefined":(0,o.default)(r)))return r.v}catch(t){return E.error("queryAllfromList fail",t.toString()),[]}}),U=function(t){var e=[];return isNullOrEmpty(t)?(E.info("delContactOperationRecord contactList empty!"),[]):(t.forEach(function(r){if(0===r.staff_id)return r.gender=2,e.push(r),!1;var n=t.queryList({staff_id:r.staff_id});if(!isNullOrEmpty(n))if(1===n.length)e.push(r);else{for(var a=n[0],o=1;o<n.length;o++){var c=n[o];c.id>a.id&&(a=c)}isNullOrEmpty(e.query(a))&&e.push(a)}}),e)},G=function(t,e){try{var r=[];return t.forEach(function(t){""===t.name&&(0,p.default)(t,e.query({staff_id:t.staff_id}),{state:t.state}),r.push(t)}),r}catch(t){return E.error("delCoverEserverList",{error:t.toJSON()}),[]}},M=e.queryUsersIncrementFromEaddr=function(){var t=(0,g.default)(l.default.mark(function t(e,r){var n,a,o,c,i,s,d,p,f;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=[],a=[],t.next=5,(0,S.preQueryUserListEaddr)(e,r);case 5:o=t.sent,c=coreAccount.getLoginModel().isSupportAS?200:20,i=o.splitByNum(c),s=0;case 9:if(!(s<i.length)){t.next=18;break}return d=i[s],t.next=13,coreContact.queryUserListFromEaddr(d);case 13:p=t.sent,!isNullOrEmpty(p)&&p.entry&&n.push.apply(n,(0,u.default)(p.entry));case 15:s++,t.next=9;break;case 18:if(f=[],!isNullOrEmpty(n)){t.next=22;break}return E.error("queryUsersIncrementFromEaddr willCoverList is empty"),t.abrupt("return",[]);case 22:return n.forEach(function(t){if(t.result_code===constant.EADDR_CONTACT_RESULT_CODE.NO_CHANGE){var e=r.query({etag:t.etag});isNullOrEmpty(e)||(delete e.id,delete e.contact_id,f.push(e))}else t.result_code===constant.EADDR_CONTACT_RESULT_CODE.SUCCESS&&f.push(t)}),t.abrupt("return",f);case 26:return t.prev=26,t.t0=t.catch(0),E.error("queryUsersIncrementFromEaddr",{error:t.t0.toJSON()}),t.abrupt("return",[]);case 30:case"end":return t.stop()}},t,void 0,[[0,26]])}));return function(e,r){return t.apply(this,arguments)}}(),P=e.coverUserList=function(t,e){if(isNullOrEmpty(t)&&isNullOrEmpty(e))return E.info("coverUserList all empty"),[];if(isNullOrEmpty(t))return E.info("coverUserList eSerList empty"),e;if(isNullOrEmpty(e))return E.info("coverUserList eaddrList empty"),t;var r=[];return t.length<e.length?e.forEach(function(e){var n=t.query({account:e.account}),a=R(n,e);r.push(a)}):t.forEach(function(t){if(isNullOrEmpty(t.account))r.push(t);else{var n=e.query({account:t.account}),a=R(t,n);r.push(a)}}),r},R=function(t,e){if(isNullOrEmpty(t)&&isNullOrEmpty(e))return E.info("coverUserInfo all empty"),{};if(isNullOrEmpty(t))return E.debug("coverUserInfo eserverInfo empty"),e;if(isNullOrEmpty(e))return E.debug("coverUserInfo eaddrInfo empty"),t;if(t.account!==e.account)return E.debug("coverUserInfo two info is not one person!"),{};var r={staff_id:t.staff_id,account:t.account,etag:e.etag,state:t.state,name:e.name,q_pin_yin:t.q_pin_yin,gender:e.gender,mobile:e.mobile,office_phone:e.office_phone,office_phone2:e.office_phone2,other_phone:e.other_phone,fax:e.fax,email:e.email,address:e.address,title:e.title,image_id:e.image_id,signature:t.signature,website:e.website,bind_no:e.bind_no,native_name:e.native_name,home_phone:e.home_phone,other_phone2:e.other_phone2,staff_no:e.staff_no,dept_id:t.dept_id,dept_name_cn:e.dept_name_cn,dept_name_en:e.dept_name_en,desc:t.desc,image_sync_time:t.image_sync_time,ip_phone:t.ip_phone,is_security:t.is_security,old_account:t.old_account,short_phone:e.short_phone,voip:t.voip,modify_time:t.modify_time,espacenumber:e.espacenumber};return void 0!==t.id&&(r.id=t.id),r},$=function(){var t=(0,g.default)(l.default.mark(function t(e){var r,n,a,o,c,u;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e||[],E.info("deal increment contactList at AS, length : ",r.length),r.length){t.next=4;break}return t.abrupt("return",[]);case 4:if(n=[],a=[],o=[],r.map(function(t){t.state===constant.CONTACT_STATE.ADD?o.push({id:t.staffAccount||t.name}):a.push(t.staffAccount||t.name)}),!a.length){t.next=14;break}return t.next=11,coreDb.queryContactList({all:"",accountlist:a});case 11:t.t0=t.sent,t.next=15;break;case 14:t.t0=[];case 15:return c=t.t0,E.info("deal increment contactList at AS, need to delete count : ",c&&c.length),c&&c.map(function(t){n.push(coreDb.deleteContact({id:t.id}))}),t.next=20,h.default.all(n);case 20:if(E.info("deal increment contactList at AS, need to add count : ",o.length),!o.length){t.next=27;break}return t.next=24,coreContact.syncUserDetails(o);case 24:t.t1=t.sent,t.next=28;break;case 27:t.t1=[];case 28:return u=t.t1,u.map(function(t){for(var e=0;e<r.length;e++)if(t.account===r[e].staffAccount){t.contact_id=r[e].id;break}}),t.abrupt("return",u);case 31:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}()},117:function(t,e,r){t.exports={default:r(148),__esModule:!0}},118:function(t,e,r){t.exports=r(0)(33)},119:function(t,e,r){t.exports=r(0)(34)},121:function(t,e,r){t.exports=r(0)(573)},126:function(t,e,r){t.exports=r(0)(43)},129:function(t,e,r){"use strict";e.__esModule=!0;var n=r(141),a=function(t){return t&&t.__esModule?t:{default:t}}(n);e.default=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return(0,a.default)(t)}},131:function(t,e,r){t.exports={default:r(175),__esModule:!0}},132:function(t,e,r){t.exports=r(0)(242)},134:function(t,e,r){t.exports={default:r(157),__esModule:!0}},136:function(t,e,r){var n=r(10),a=r(8),o=r(137);t.exports=function(t,e){var r=(a.Object||{})[t]||Object[t],c={};c[t]=e(r),n(n.S+n.F*o(function(){r(1)}),"Object",c)}},137:function(t,e,r){t.exports=r(0)(60)},141:function(t,e,r){t.exports={default:r(165),__esModule:!0}},143:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var a=r(177),o=n(a),c=r(134),u=n(c);e.default=function(){function t(t,e){var r=[],n=!0,a=!1,o=void 0;try{for(var c,i=(0,u.default)(t);!(n=(c=i.next()).done)&&(r.push(c.value),!e||r.length!==e);n=!0);}catch(t){a=!0,o=t}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}return r}return function(e,r){if(Array.isArray(e))return e;if((0,o.default)(Object(e)))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},144:function(t,e,r){t.exports=r(0)(134)},148:function(t,e,r){r(149),t.exports=r(8).Object.getPrototypeOf},149:function(t,e,r){var n=r(132),a=r(150);r(136)("getPrototypeOf",function(){return function(t){return a(n(t))}})},150:function(t,e,r){t.exports=r(0)(596)},157:function(t,e,r){r(23),r(22),t.exports=r(158)},158:function(t,e,r){var n=r(9),a=r(26);t.exports=r(8).getIterator=function(t){var e=a(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return n(e.call(t))}},164:function(t,e,r){t.exports=r(0)(81)},165:function(t,e,r){r(22),r(166),t.exports=r(8).Array.from},166:function(t,e,r){"use strict";var n=r(11),a=r(10),o=r(132),c=r(31),u=r(32),i=r(27),s=r(167),d=r(26);a(a.S+a.F*!r(33)(function(t){Array.from(t)}),"Array",{from:function(t){var e,r,a,p,f=o(t),l="function"==typeof this?this:Array,v=arguments.length,h=v>1?arguments[1]:void 0,m=void 0!==h,g=0,C=d(f);if(m&&(h=n(h,v>2?arguments[2]:void 0,2)),void 0==C||l==Array&&u(C))for(e=i(f.length),r=new l(e);e>g;g++)s(r,g,m?h(f[g],g):f[g]);else for(p=C.call(f),r=new l;!(a=p.next()).done;g++)s(r,g,m?c(p,h,[a.value,g],!0):a.value);return r.length=g,r}})},167:function(t,e,r){"use strict";var n=r(25),a=r(168);t.exports=function(t,e,r){e in t?n.f(t,e,a(0,r)):t[e]=r}},168:function(t,e,r){t.exports=r(0)(80)},175:function(t,e,r){r(176),t.exports=r(8).Object.keys},176:function(t,e,r){var n=r(132),a=r(164);r(136)("keys",function(){return function(t){return a(n(t))}})},177:function(t,e,r){t.exports={default:r(178),__esModule:!0}},178:function(t,e,r){r(23),r(22),t.exports=r(179)},179:function(t,e,r){var n=r(16),a=r(6)("iterator"),o=r(17);t.exports=r(8).isIterable=function(t){var e=Object(t);return void 0!==e[a]||"@@iterator"in e||o.hasOwnProperty(n(e))}},2120:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.setSign=e.uploadAvatar=e.getHeaders=e.post=e.request=e.loginToItMcloud=void 0;var a=r(121),o=n(a),c=r(67),u=n(c),i=r(144),s=n(i),d=r(1),p=n(d),f=r(2),l=n(f),v=(e.loginToItMcloud=function(){var t=(0,l.default)(p.default.mark(function t(){var e,r,n,a,o,c;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return v.info("loginToItMcloud"),h=coreAccount.getLoginModel(),e=h,r=e.itOAuthUrl,n=e.account,t.next=5,coreSecurity.PasswordManager.getPassword("password");case 5:return a=t.sent,o="loginName="+n+"&password="+a+"&publicKeyFlag=4",t.next=9,g(r,o,{"Content-Type":"application/x-www-form-urlencoded"});case 9:if(c=t.sent,0!==c.result||!c.data){t.next=13;break}return v.info("loginToItMcloud successfully"),t.abrupt("return",{result:0,data:c.data.crypt_token});case 13:return v.info("loginToItMcloud error"),t.abrupt("return",{result:1});case 15:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),e.uploadAvatar=function(){var t=(0,l.default)(p.default.mark(function t(e){var r,n,a,o,c=e.imageStr,u=e.fileName;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return v.info("itEab uploadAvatar"),r=coreAccount.getLoginModel(),n="https://"+r.middleEndAddress+"/mcloud/mag/ProxyForText/wecontact/personService/v2/uploadHeadImgInfo",a=C(r.crypt_token),t.next=6,g(n,{imageStr:c,fileName:u},a);case 6:return o=t.sent,v.info("itEab uploadAvatar result: ",o.result,o.data&&o.data.msg),t.abrupt("return",{result:0===o.result&&o.data.flag?0:1});case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),e.setSign=function(){var t=(0,l.default)(p.default.mark(function t(e){var r,n,a,o;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return v.info("itEab setSign"),r=coreAccount.getLoginModel(),n="https://"+r.middleEndAddress+"/mcloud/mag/ProxyForText/wecontact/contactService/remarkOrSignedMain",a=C(r.crypt_token),t.next=6,g(n,{signed:e,action:"sign"},a);case 6:return o=t.sent,v.info("itEab setSign result: ",o.result,o.data&&o.data.msg),t.abrupt("return",{result:0===o.result&&o.data.flag?0:1});case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),window.Logger("logic")("itEab")),h=null,m=e.request=function(){var t=(0,l.default)(p.default.mark(function t(e){var r,n,a,o,c,u,i,s,d,f,l,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return h||(h=coreAccount.getLoginModel()),t.next=3,new coreHttp.hwTupHttpTransSdk;case 3:return r=t.sent,n=h,a=n.proxyAddress,o=n.proxyPort,c=n.proxyAccount,u=n.isSupportProxy,t.next=7,coreSecurity.PasswordManager.getPassword("proxyPassword");case 7:return i=t.sent,s=coreAccount.getLoginModel(),d=s.isSupportCACertCheck,u||(a="",o=0,c="",i=""),f={url:e,type:v.type,header:v.headers||"",body:v.body||"",proxyInfo:{proxyAddress:a,proxyPort:o,proxyAccount:c,proxyPassword:i},tlsParam:{caCertPath:window.EXEC_PATH,tlsMode:d?1:0},cipherlist:[50331695,50331701,50331708,50331709]},t.next=13,r.sendSyncRequest(f);case 13:if(l=t.sent,200!==l.param.resp_code){t.next=16;break}return t.abrupt("return",{result:0,data:JSON.parse(l.param.recv_body)});case 16:return t.abrupt("return",l);case 17:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),g=e.post=function(){var t=(0,l.default)(p.default.mark(function t(e,r,n){var a;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m(e,{type:constant.REQUEST_TYPE.POST,headers:n,body:"object"===(void 0===r?"undefined":(0,s.default)(r))?(0,u.default)(r):r});case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}},t,void 0)}));return function(e,r,n){return t.apply(this,arguments)}}(),C=e.getHeaders=function(t){return(0,o.default)({"Content-Type":"application/json"},{Cookie:"token="+t})}},2121:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.createContactInfoChangeEvent=e.saveContactInfo=e.saveContactInfoList=void 0;var a=r(1),o=n(a),c=r(2),u=n(c),i=window.Logger("group")("detail"),s=(e.saveContactInfoList=function(){var t=(0,u.default)(o.default.mark(function t(e){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i.info("saveContactInfoList "),t.next=4,coreDb.bulkPutContact(e);case 4:s(e.map(function(t){return t.account})),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),i.error("saveContactInfoList ",t.t0.toString());case 10:case"end":return t.stop()}},t,void 0,[[0,7]])}));return function(e){return t.apply(this,arguments)}}(),e.saveContactInfo=function(){var t=(0,u.default)(o.default.mark(function t(e){var r;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i.info("saveContactInfo "),t.next=4,coreDb.saveContact(e);case 4:return r=t.sent,s([e.account]),t.abrupt("return",r);case 9:t.prev=9,t.t0=t.catch(0),i.error("saveContactInfo ",t.t0.toString());case 12:case"end":return t.stop()}},t,void 0,[[0,9]])}));return function(e){return t.apply(this,arguments)}}(),e.createContactInfoChangeEvent=function(t){var e=new Event("contactInfoChange");e.data={accountList:t},window.dispatchEvent(e)})},2122:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.getDepartmentTree=e.updateDepartmentTree=e.updateDepartmentUserList=e.initDepartmentTree=e.getMoreDirectorySearchResult=e.getDirectorySearchResult=e.setDirectorySearchValue=e.getDirectoryMenuKeyScroll=e.loadMoreServerContact=e.loadServerContact=void 0;var a=r(121),o=n(a),c=r(1),u=n(c),i=r(67),s=n(i),d=r(129),p=n(d),f=r(2),l=n(f),v=r(417),h=window.Logger("contactGroup")("corporateDirectory"),m=(e.loadServerContact=function(){var t=(0,l.default)(u.default.mark(function t(e){var r,n,a,o;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!window.CLIENTCONFIG.ENABLE_IT_MEETING){t.next=3;break}return h.info("[IT-Meeting] no need to loadServerContact"),t.abrupt("return");case 3:return t.prev=3,h.debug("初始加载企业通讯录"),$dispatch(coreUi.toggleDirectoryInitLoading(!0)),t.next=8,coreContact.searchServerContact(e);case 8:return r=t.sent,n=r.userInformationList,a=r.recordAmount,isNullOrEmpty(n)||$dispatch(coreUi.getRecordInformation(a,n)),window.CLIENTCONFIG.ISMOBILE||isNullOrEmpty(n)||(0,v.detectContactStatus)([].concat((0,p.default)(n)).map(function(t){return{account:t.account}})),o=[],isNullOrEmpty(n)||(o=n.map(function(t){var e=t.account;return handlePhoneNumber(e.substring(0,e.length-4))})),$dispatch(coreUi.toggleDirectoryInitLoading(!1)),h.info("首次加载企业通讯录",o),t.abrupt("return",n);case 19:t.prev=19,t.t0=t.catch(3),h.error("首次加载企业通讯录",{error:(0,s.default)(t.t0)});case 22:case"end":return t.stop()}},t,void 0,[[3,19]])}));return function(e){return t.apply(this,arguments)}}(),e.loadMoreServerContact=function(){var t=(0,l.default)(u.default.mark(function t(e){var r,n,a,o,c,i,s,d,f,l;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=$getState(),n=r.contactGroups.isRecordInformationLoading,a=r.contactGroups.userInformationList,o=r.contactGroups.recordAmount,h.info("loadMoreServerContact",n),a.length!==o){t.next=8;break}return t.abrupt("return");case 8:if(!n){t.next=11;break}return h.info("loadMoreServerContact 正在加载更多用户消息"),t.abrupt("return");case 11:return $dispatch(coreUi.setRecordInformationLoading()),c=$getState().contactGroups.userInformationList.length,t.next=15,coreContact.searchServerContact(e,c);case 15:return i=t.sent,s=i.userInformationList,d=i.recordAmount,isNullOrEmpty(s)||c<d&&$dispatch(coreUi.addRecordInformation(s)),window.CLIENTCONFIG.ISMOBILE||isNullOrEmpty(s)||(0,v.detectContactStatus)([].concat((0,p.default)(s)).map(function(t){return{account:t.account}})),$dispatch(coreUi.setRecordInformationNotLoading()),f=[],isNullOrEmpty(s)||(f=s.map(function(t){var e=t.account;return handlePhoneNumber(e.substring(0,e.length-4))})),h.info("加载更多企业通讯录",f),l=void 0,isNullOrEmpty(s)||(l=a.concat(s)),t.abrupt("return",l);case 28:t.prev=28,t.t0=t.catch(0),h.error("loadMoreServerContact 加载更多企业通讯录",{error:t.t0.toJSON()});case 31:case"end":return t.stop()}},t,void 0,[[0,28]])}));return function(e){return t.apply(this,arguments)}}(),e.getDirectoryMenuKeyScroll=function(){var t=(0,l.default)(u.default.mark(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:$dispatch(coreUi.getDirectoryMenuKeyScroll(e));case 1:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),e.setDirectorySearchValue=function(t,e){$dispatch(coreUi.setDirectorySearchValue(t,e))},e.getDirectorySearchResult=function(t,e){window.isOffline&&window.CLIENTCONFIG.ISMOBILE&&window.Toast(language.THE_NETWORK_IS_ABNORMAL,1,!1),$dispatch(coreUi.getDirectorySearchResult(t,e))},e.getMoreDirectorySearchResult=function(){var t=(0,l.default)(u.default.mark(function t(){var e,r,n,a,o,c,i,s,d,p;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,h.info("加载更多搜索企业通讯录结果"),window.isOffline&&window.CLIENTCONFIG.ISMOBILE&&window.Toast(language.THE_NETWORK_IS_ABNORMAL,1,!1),e=$getState(),r=e.contactGroups,n=r.directorySearchList,a=r.directorySearchValue,o=r.searchRecordAmount,c=[],i=o,!n){t.next=15;break}return s=n.length,t.next=11,coreContact.searchServerContact(a,s);case 11:d=t.sent,p=d.userInformationList||[],i=d.recordAmount,c=n.concat(p);case 15:$dispatch(coreUi.getDirectorySearchResult(c,i)),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(0),h.error("getMoreDirectorySearchResult 加载更多搜索企业通讯录结果",{error:t.t0.toJSON()});case 21:case"end":return t.stop()}},t,void 0,[[0,18]])}));return function(){return t.apply(this,arguments)}}(),function(){$dispatch(coreUi.updateFlatDepartmentTree("{}")),$dispatch(coreUi.updateDepartmentRoot("")),$dispatch(coreUi.updateMyDepartmentCode("")),$dispatch(coreUi.updateDepartmentInShow("")),$dispatch(coreUi.updateDepartmentShowTree(!1))}),g=function(t,e){t.hasOwnProperty("childDepts")&&delete t.childDepts;var r=t.deptCode||"";if(!r)return void h.info("invalid deptCode.");e[r]||(e[r]={}),(0,o.default)(e[r],t)},C=function t(e,r){if(e.isSelfNode){if(!e.hasOwnProperty("deptCode"))return void h.info("invalid deptcode.");$dispatch(coreUi.updateMyDepartmentCode(e.deptCode)),$dispatch(coreUi.updateDepartmentInShow(e.deptCode))}if(e.isLeafNode)return g(e,r);if(!e.hasOwnProperty("childDepts"))return g(e,r);var n=e.childDepts||[];delete e.childDepts,e.isLeafNode=!1,e.subDepts=[],n.forEach(function(t){t.hasOwnProperty("deptCode")&&e.subDepts.push(t.deptCode)}),g(e,r),n.forEach(function(e){t(e,r)})},b=e.initDepartmentTree=function(){var t=(0,l.default)(u.default.mark(function t(){var e,r,n,a;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(coreAccount.getLoginModel().isSupportAS&&!window.CLIENTCONFIG.ENABLE_IT_MEETING){t.next=3;break}return h.info("no need to init department tree."),t.abrupt("return");case 3:if(h.info("begin init department tree."),!(e=$getState().contactGroups.departmentRoot)){t.next=8;break}return h.info("Department Tree Already init."),t.abrupt("return");case 8:return h.info("init Department Tree"),m(),t.next=12,coreContact.getDeptTree();case 12:if((r=t.sent)&&r.hasOwnProperty("deptCode")){t.next=16;break}return h.info("failed to fetch Department Tree."),t.abrupt("return");case 16:if($dispatch(coreUi.updateDepartmentRoot(r.deptCode)),$dispatch(coreUi.updateDepartmentShowTree(!0)),n={},C(r,n),$dispatch(coreUi.updateFlatDepartmentTree((0,s.default)(n))),a=$getState().contactGroups.myDepartmentCode){t.next=27;break}return h.info("failed to get my department."),t.abrupt("return");case 27:return t.next=29,x(a);case 29:return t.next=31,y(a);case 31:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),y=e.updateDepartmentUserList=function(){var t=(0,l.default)(u.default.mark(function t(){var e,r,n,a,o,c,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:h.info("begin update user list in department."),e={},t.prev=2,e=JSON.parse($getState().contactGroups.flatDepartmentUsers),t.next=10;break;case 6:return t.prev=6,t.t0=t.catch(2),h.error("invalid department : "+t.t0),t.abrupt("return");case 10:if(r={},""===i?i=$getState().contactGroups.departmentInShow:r[i]=e[i]||{},r){t.next=15;break}return h.error("invalid department Code."),t.abrupt("return");case 15:if(r.hasOwnProperty(i)||(r[i]={}),n=r[i],(a=n.hasOwnProperty("data")?n.data.length:0)!==n.totalCount){t.next=21;break}return h.info("No Need to fetch User List."),t.abrupt("return");case 21:return $dispatch(coreUi.setRecordInformationLoading()),t.next=24,coreContact.getDeptUserList(i,a,!coreCommon.isMobile());case 24:if(o=t.sent){t.next=29;break}return h.info("failed to get user list in department."),$dispatch(coreUi.setRecordInformationNotLoading()),t.abrupt("return");case 29:n.pageIndex=o.pageIndex,n.totalCount=o.totalCount,n.pageSize=o.pageSize,n.hasOwnProperty("data")?(c={},n.data=n.data.concat(o.data),n.data=n.data.filter(function(t){var e=t.account;if(e){if(c.hasOwnProperty(e))return!1;c[e]=!0}return!0})):n.data=o.data,$dispatch(coreUi.updateFlatDepartmentUsers((0,s.default)(r))),$dispatch(coreUi.setRecordInformationNotLoading());case 35:case"end":return t.stop()}},t,void 0,[[2,6]])}));return function(){return t.apply(this,arguments)}}(),x=e.updateDepartmentTree=function(){var t=(0,l.default)(u.default.mark(function t(){var e,r,n,a,o,c,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(h.info("begin update department tree."),""!==i){t.next=3;break}return t.abrupt("return",b());case 3:e=void 0,t.prev=4,e=JSON.parse($getState().contactGroups.flatDepartmentTree),t.next=12;break;case 8:return t.prev=8,t.t0=t.catch(4),h.error("invalid department tree: "+t.t0),t.abrupt("return");case 12:if(r=e[i]||null){t.next=16;break}return h.info("failed to get the specified department info."),t.abrupt("return");case 16:return t.next=18,coreContact.getDeptList(i);case 18:if(n=t.sent){t.next=22;break}return h.info("failed to get sub department list."),t.abrupt("return");case 22:if(n.deptCode===i){t.next=25;break}return h.info("the deptCode for new Department mismatch."),t.abrupt("return");case 25:a=n.childDepts||[],o=[],a.forEach(function(t){t.hasOwnProperty("deptCode")&&""!==t.deptCode&&o.push(t.deptCode)}),c=r.subDepts||[],c.forEach(function(t){-1===o.indexOf(t)&&e.hasOwnProperty(t)&&delete e[t]}),n.subDepts=o,0===n.subDepts.length&&(n.isLeafNode=!0,delete n.subDepts),a.forEach(function(t){t.hasOwnProperty("deptCode")&&""!==t.deptCode&&g(t,e)}),n.hasOwnProperty("childDepts")&&n.childDepts.length>0&&(n.isLeafNode=!1,delete n.childDepts),g(n,e),$dispatch(coreUi.updateFlatDepartmentTree((0,s.default)(e)));case 36:case"end":return t.stop()}},t,void 0,[[4,8]])}));return function(){return t.apply(this,arguments)}}();e.getDepartmentTree=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=void 0;try{r=JSON.parse($getState().contactGroups.flatDepartmentTree)}catch(t){return void h.error("invalid department tree: "+t)}var n=""===e?$getState().contactGroups.departmentRoot:e,a=r[n];if(!n||!a)return h.info("failed to generate department tree."),{};var o={};if(o.deptCode=a.deptCode,o.deptName=a.deptName,o.isLeafNode=a.isLeafNode||!1,o.isSelfNode=a.isSelfNode||!1,o.childDepts=[],a.hasOwnProperty("subDepts")){a.subDepts.forEach(function(e){if(""!==e){var r=t(e);r&&o.childDepts.push(r)}})}return o.childDepts.length<1&&delete o.childDepts,o}},2123:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.setDirectoryMenu=e.togglePageList=void 0;var a=r(1),o=n(a),c=r(2),u=n(c);e.togglePageList=function(){var t=(0,u.default)(o.default.mark(function t(e){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:$dispatch(coreUi.updateMobileListContent(e));case 1:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.setDirectoryMenu=function(t){$dispatch(coreUi.setDirectoryMenu(t))}},2124:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.setPhoneAddrPageSearching=e.saveInitPhoneContactList=e.setPhoneAddrPageLoadIndex=e.setPhoneAddrPageLoading=e.searchPhoneContact=e.getPhoneContacts=void 0;var a=r(121),o=n(a),c=r(129),u=n(c),i=r(1),s=n(i),d=r(3),p=n(d),f=r(2),l=n(f),v=window.Logger("logic")("phoneContacts"),h=(e.getPhoneContacts=function(){var t=(0,l.default)(s.default.mark(function t(){var e,r,n,a,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(v.info("userClick phone address menu,try to access the phone's contacts"),v.info("begin get mobile contacts, bSelect: "+o),e=$getState(),r=e.contactGroups.isPhoneAddrLoading,!r){t.next=6;break}return v.warn("already loading"),t.abrupt("return");case 6:if(!o){t.next=11;break}if(n=$getState(),a=n.common.phoneAddr_ContactList,isNullOrEmpty(a)){t.next=11;break}return v.info("select phone address page, already has contact"),t.abrupt("return");case 11:return g(!0),t.abrupt("return",new p.default(function(t,e){var r=new ContactFindOptions;r.filter=c,r.multiple=!0,r.desiredFields=[navigator.contacts.fieldType.displayName,navigator.contacts.fieldType.phoneNumbers],r.hasPhoneNumber=!0;var n=["displayName","firstName","lastName","familyName","middleName","givenName","name","nickname","phoneNumbers"];navigator.contacts.find(n,function(e){v.info("get mobile contacts success");var r=m(e,o),n=r.mList,a=r.enList,c=window.getRoute();if("phoneAddrListPage"!==c&&"directorySearch"!==c&&"callMain"!==c&&"mConfMemberPage"!==c&&"selectPhoneContact"!==c&&!o)return v.warn("already return from phone contact page"),$dispatch(coreUi.setPhoneAddrLoading(!1)),void C(n,a);o?($dispatch(coreUi.togglePhoneAddrContactList(n)),C(n,a),t()):$dispatch(coreUi.updatePhoneContactList(n,a)),$dispatch(coreUi.setPhoneAddrLoading(!1))},function(t){v.info("get mobile contacts failed, ",t),$dispatch(coreUi.setPhoneAddrLoading(!1)),e(t)},r)}));case 13:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),e.searchPhoneContact=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return v.info("begin search mobile contacts, "+e),e&&isNullOrEmpty(t)?($dispatch(coreUi.togglePhoneAddrSearchList([])),{}):(g(!0),new p.default(function(r,n){var a=new ContactFindOptions;a.filter=t,a.multiple=!0,a.desiredFields=[navigator.contacts.fieldType.displayName,navigator.contacts.fieldType.phoneNumbers],a.hasPhoneNumber=!0;var o=["displayName","firstName","lastName","familyName","middleName","givenName","name","nickname","phoneNumbers"];navigator.contacts.find(o,function(n){v.info("search mobile contacts success"),g(!1);var a=h(n,t,e),o=a,c=a.length;return r({recordAmount:c,userInformationList:o})},function(t){g(!1),v.info("search mobile contacts failed, ",t),r({})},a)}))},function(t,e,r){v.info("parseSearchContacts: "+t.length);for(var n=t.sort(function(){return function(t,e){var r=window.pinyinUtil.getPinyin(t.displayName),n=window.pinyinUtil.getPinyin(e.displayName);return r.localeCompare(n)}}()),a=[],c=0;c<n.length;c++)if(n[c].phoneNumbers){var i={displayName:n[c].displayName,phoneNumbers:[].concat((0,u.default)(n[c].phoneNumbers)),id:n[c].id};if(r){var s=b(i);(0,o.default)(i,{isSelected:!1,isExpanded:!1,numberInfo:s}),a.push({type:"charItem",item:i,itemKey:i.id})}else a.push({type:"charItem",item:i,itemKey:i.id})}return a}),m=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];v.info("parseContacts: "+t.length);for(var r=t.sort(function(){return function(t,e){var r=window.pinyinUtil.getPinyin(t.displayName),n=window.pinyinUtil.getPinyin(e.displayName);return r.localeCompare(n)}}()),n=[],a=[],c=[],i=1,s=!1,d=0;d<r.length;d++)if(r[d].phoneNumbers&&0!==r[d].phoneNumbers.length){var p={displayName:r[d].displayName,phoneNumbers:[].concat((0,u.default)(r[d].phoneNumbers)),id:r[d].id,pinyin:r[d].displayName?window.pinyinUtil.getPinyin(r[d].displayName):""};if(e){var f=b(p);(0,o.default)(p,{isSelected:!1,isExpanded:!1,numberInfo:f})}var l=!0,h="",m="";p.displayName?(h=window.pinyinUtil.getPinyin(p.displayName.trim()).toLowerCase(),m=h.charAt(0)):l=!1;var g=/^[a-z]$/;l&&""!==m&&isNaN(parseInt(m))&&g.test(m)?(n.includes(m)||(n.push(m),a.push({type:"charTitle",char:m,char_index:i++})),a.push({type:"charItem",item:p,itemKey:p.id})):(s=!0,c.push({type:"charItem",item:p,itemKey:p.id}))}var C=[];return s&&(n.push("#"),C=c.sort(function(){return function(t,e){var r=t.item.displayName,n=e.item.displayName;return r&&n?r.localeCompare(n):!r&&n?(r=t.item.phoneNumbers[0].value,r?r.localeCompare(n):0):r&&!n?(n=e.item.phoneNumbers[0].value,n?r.localeCompare(n):0):r||n?0:(r=t.item.phoneNumbers[0].value,n=e.item.phoneNumbers[0].value,r&&n?r.localeCompare(n):0)}}()),C.unshift({type:"charTitle",char:"#",char_index:27})),a.push.apply(a,(0,u.default)(C)),{mList:a,enList:n}},g=e.setPhoneAddrPageLoading=function(t){$dispatch(coreUi.setPhoneAddrLoading(t))},C=(e.setPhoneAddrPageLoadIndex=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;$dispatch(coreUi.setPhoneAddrLoadIndex(t))},e.saveInitPhoneContactList=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=[],n=[];if(isNullOrEmpty(t)||isNullOrEmpty(e)){var a=$getState().contactGroups,o=a.mPhoneContactList,c=a.mEnPhoneList;r=o,n=c}else r=t,n=e;$dispatch(coreUi.updatePhoneContactList(r,n))}),b=(e.setPhoneAddrPageSearching=function(t){$dispatch(coreUi.setPhoneAddrSearching(t))},function(t){for(var e={},r=0,n=0,a=0,c=0,u=0;u<t.phoneNumbers.length;u++){var i=t.phoneNumbers[u],s="";"mobile"===i.type||"移动"===i.type?(s="mobile"+(r?r.toString():""),r++):"home"===i.type?(s="home_phone"+(n?n.toString():""),n++):"work"===i.type?(s="office_phone"+(a?a.toString():""),a++):(s="other_phone"+(c?c.toString():""),c++);var d={};d[s]={number:i.value,isSelected:!1},(0,o.default)(e,d)}return e})},2125:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});window.Logger("service")("service/util/contactUtils"),e.getCallNumList=function(t){if(!t)return[];var e=[];return Object.forEach(constant.USER_INFO.CALL_INFO,function(r,n){isNullOrEmpty(t[r])||!isNullOrEmpty(t.bind_no)&&"espacenumber"===r||!isNullOrEmpty(t.short_phone)&&"office_phone2"===r||e.push({key:n,num:t[r]})}),e},e.getVideoNumList=function(t){if(!t)return[];var e=[];return Object.forEach(constant.USER_INFO.VIDEO_INFO,function(r,n){isNullOrEmpty(t[r])||!isNullOrEmpty(t.bind_no)&&"espacenumber"===r||!isNullOrEmpty(t.short_phone)&&"office_phone2"===r||e.push({key:n,num:t[r]})}),e}},2126:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.callClickFunc=e.videoClickFunc=e.playDialAudio=e.clickFunc=void 0;var a=r(1),o=n(a),c=r(126),u=n(c),i=r(2),s=n(i);window.Logger("contact")("recentcall"),e.clickFunc=function(){var t=(0,s.default)(o.default.mark(function t(e,r,n,a,c,i){var s,d,p,f,l,v;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(s=e.peeraccount,d=e.calleenumber,p=coreConf.showOrDisabledBtn()){t.next=4;break}return t.abrupt("return");case 4:if(!n||a||!i){t.next=6;break}return t.abrupt("return");case 6:return f=void 0,l=void 0,t.next=9,coreContact.getContactByAccount(s);case 9:if(v=t.sent,c&&c.contact_id&&!c.account?l=(0,u.default)({},c):isNullOrEmpty(v)?l=r===s?coreSearch.getTempCallUserInfo(s,language.VOICE_MAIL_BOX,!0):coreSearch.getTempCallUserInfo(s):(f=v.bind_no,l=v),!i){t.next=17;break}if(!window.SERVERCONFIG.HWUC){t.next=16;break}return t.abrupt("return",alert(language.COMMON_FUNCTION_IS_NOT_AVAILABLE));case 16:return t.abrupt("return",coreCall.CallOut(d,l,!0));case 17:if(isNullOrEmpty(f)||l.bind_no!==d||!window.SERVERCONFIG.HWUC){t.next=19;break}return t.abrupt("return",coreCall.CallOut("*"+d,l));case 19:return t.abrupt("return",coreCall.voiceCallPC(d,l));case 20:case"end":return t.stop()}},t,void 0)}));return function(e,r,n,a,o,c){return t.apply(this,arguments)}}(),e.playDialAudio=function(t,e,r){var n=void 0;if(12===t&&(t=0),window.webView)window.webView.playRing(t+".wav",0);else if((void 0)[t]?(n=e[Number(t)+KEY_AUDIO_LEN],(void 0)[t]=!1):(n=e[t],(void 0)[t]=!0),coreCommon.isMobile()){var a=new Media(KEY_AUDIO_SRC+r[Number(t)],function(){window.log("audio load success.")},function(){window.log("audio load failed.")});a.play()}else n.currentTime=0,n.play()},e.videoClickFunc=function(){var t=(0,s.default)(o.default.mark(function t(e){var r,n;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,coreContact.searchServerContact(e,1,1);case 2:r=t.sent,n=r.userInformationList||[],0!==n.length?e.length>=7?coreCall.CallOut(e,n[0],!0):coreCall.CallOut(1===window.SERVERCONFIG.HWUC?"*"+e:e,n[0],!0):e.length>=7?coreCall.CallOut(e,coreSearch.getTempCallUserInfo(e),!0):coreCall.CallOut(1===window.SERVERCONFIG.HWUC?"*"+e:e,coreSearch.getTempCallUserInfo(e),!0);case 5:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.callClickFunc=function(){var t=(0,s.default)(o.default.mark(function t(e){var r,n;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,coreContact.searchServerContact(e,1,1);case 2:r=t.sent,n=r.userInformationList||[],0!==n.length?e.length>=7?coreCall.voiceCallPC(e,n[0]):coreCall.voiceCallPC(1===window.SERVERCONFIG.HWUC?"*"+e:e,n[0]):e.length>=7?coreCall.voiceCallPC(e,coreSearch.getTempCallUserInfo(e)):coreCall.voiceCallPC(1===window.SERVERCONFIG.HWUC?"*"+e:e,coreSearch.getTempCallUserInfo(e));case 5:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}()},2127:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.euaserver=void 0;var a=r(129),o=n(a),c=r(117),u=n(c),i=r(4),s=n(i),d=r(118),p=n(d),f=r(119),l=n(f),v=r(67),h=n(v),m=r(1),g=n(m),C=r(2),b=n(C),y=r(2128),x=n(y),w=window.Logger("logic")("login/euaserver"),_=function(){var t=(0,b.default)(g.default.mark(function t(){var e,r,n,a,o,c,u,i,s,d,p,f,l,v,h,m,C,b,y,x;return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(L()){t.next=2;break}return t.abrupt("return");case 2:return coreUt.utEventStart({eventId:constant.EVENT_ID.UT_LOGIN,extraTrackKey:constant.UT_LOGIN_SERVER_NAME.UT_EAB_SERVER,params:[constant.UT_LOGIN_SERVER_NAME.UT_EAB_SERVER]}),w.info(" start eabserverLogin"),w.info("<account_login><8_eua>begin"),t.next=7,new coreTup.HWTupEaddr;case 7:return e=t.sent,r=coreAccount.getLoginModel(),n=r.account,a=r.eabUri,o=r.groupServer,c=r.serverAddress,u=r.serverPort,i=r.serverUportalAddress,s=r.serverUportalPort,d=r.isSupportProxy,p=r.proxyAddress,f=r.proxyPort,l=r.proxyAccount,v=r.authToken,t.next=11,coreSecurity.PasswordManager.getPassword("proxyPassword");case 11:return h=t.sent,d||(p=null,f=null,l=null,h=null),m=window.CLIENTCONFIG.EAB_SEARCH_NUM||20,w.info(" eabserverLogin  eaddrConfig "),C=i||c,b=s||u,y={ServerType:3,HttpServerAddr:a||"https://"+C+":"+b+"/services",AvatarServerAddr:o||"https://"+C+":"+b+"/headportrait",PageCount:m,UserName:n,Token:v,AvatarFilePath:window.avatarPath,HttpsVerifyMode:0,HttpTimeOut:10,RCSType:1,CertFilePath:"",ProxyIpAddr:p,ProxyPort:parseInt(f),ProxyAuthUserName:l,ProxyAuthPassword:h},t.next=20,e.eaddrConfig(y);case 20:if(x=t.sent,0!==x.result){t.next=29;break}return w.info("eabserverLogin  success"),w.info("<account_login><8_eua>end ok"),coreCommon.dispatchModuleEvent("login",{event:"eua",code:0}),coreUt.utEventFinish({eventId:constant.EVENT_ID.UT_LOGIN,extraTrackKey:constant.UT_LOGIN_SERVER_NAME.UT_EAB_SERVER,resultParams:[1],isTrackTimeCosts:!0}),t.abrupt("return",coreCommon.ATOMIC_ACTION_RESULT.SUCCESS);case 29:return w.error("eabserverLogin  failed"),w.info("<account_login><8_eua>end failed"),coreCommon.dispatchModuleEvent("login",{event:"eua",code:x}),coreUt.utEventFinish({eventId:constant.EVENT_ID.UT_LOGIN,extraTrackKey:constant.UT_LOGIN_SERVER_NAME.UT_EAB_SERVER,resultParams:[0,x.result],isTrackTimeCosts:!0}),t.abrupt("return",coreCommon.ATOMIC_ACTION_RESULT.FAILED);case 34:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),k=new coreCommon.AtomicAction("eabserverLoginAtomic",_),I=function(t){var e=t&&t.result||t&&t.param&&t.param.result;if(!isNullOrEmpty(e))switch(e){case constant.ERROR_SEARCHINFO_CODE.EADDR_SUCCESS:return!0;case constant.ERROR_SEARCHINFO_CODE.EADDR_FAIL_AUTH:case constant.ERROR_SEARCHINFO_CODE.EADDR_FAIL_TOKEN:E()}return w.error("EUA request error, reason:",e),!1},S=function(t){var e=coreAccount.getLoginModel(),r=e.isSupportAS;return t.forEach(function(t){r&&t.hasOwnProperty("id")?(t.show_account=t.account,t.account=t.id,delete t.id):t.show_account=t.account}),w.debug("convert2uuid entry22",t),t},E=function(){coreAccount.actionRefreshToken()},L=function(){return!(window.CLIENTCONFIG.ISBIGWIN||!coreAccount.getLoginModel().useEab)},N=function(){return!!L()||(w.warn("EUA module is not enabled"),!1)},O=function(){var t=(0,b.default)(g.default.mark(function t(){var e,r,n,a,o,c;return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=coreAccount.getLoginModel(),r=e.proxyAddress,n=e.proxyPort,a=e.proxyAccount,o=e.isSupportProxy,t.next=4,coreSecurity.PasswordManager.getPassword("proxyPassword");case 4:return c=t.sent,o||(r="",n=0,a="",c=""),t.abrupt("return",{proxyAddress:r,proxyPort:n,proxyAccount:a,proxyPassword:c});case 7:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),T=function(){var t=(0,b.default)(g.default.mark(function t(e){var r,n,a,o,c,u,i,s,d,p,f,l,v,h,m,C=e.path,b=void 0===C?"":C,y=e.header,x=void 0===y?{}:y,_=e.body,k=void 0===_?"":_;return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,O();case 2:if(r=t.sent,n=coreAccount.getLoginModel(),a=n.authToken,o=n.serverUportalAddress,c=n.serverAddress,u=n.serverUportalPort,i=n.serverPort,s=o||c,d=u||i,p="https://"+s+":"+d,"/"===b[0]?p+=b:p=p+"/rest/usg/abs/v1/"+b,f=coreAccount.getLoginModel(),l=f.isSupportCACertCheck,v=f.displayAccount,h={caCertPath:window.EXEC_PATH,tlsMode:l?1:0},""!==a){t.next=13;break}return w.error("invalid authToken for EUA Request."),t.abrupt("return",null);case 13:return m={url:p,type:constant.REQUEST_TYPE.GET,header:{Authorization:"Basic "+a,"X-Request-Operator":v||""},body:k,proxyInfo:r,tlsParam:h,cipherlist:[]},""!==k&&(m.type=constant.REQUEST_TYPE.POST,m.header["Content-Type"]="application/json"),x.hasOwnProperty("etag")&&(m.header.etag=x.etag),t.abrupt("return",m);case 17:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),A=function(){var t=(0,b.default)(g.default.mark(function t(){var e,r,n,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e="user/_search",s=s||window.CLIENTCONFIG.EAB_SEARCH_NUM,r=parseInt(a/s)+1,n=(0,h.default)({pageIndex:r,pageSize:s,searchKey:c,deptCode:o,querySubDept:u,searchScope:i}),t.abrupt("return",T({path:e,body:n}));case 5:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),D=function(){var t=(0,b.default)(g.default.mark(function t(){var e,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",c=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,A(a,n,o,c);case 2:if(e=t.sent){t.next=5;break}return t.abrupt("return",null);case 5:return t.next=7,M(e);case 7:return r=t.sent,r&&r.hasOwnProperty("data")&&(r.data=S(r.data)),t.abrupt("return",r);case 10:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),U=function(){var t=(0,b.default)(g.default.mark(function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e="user/_detail",t.abrupt("return",T({path:e,body:r}));case 2:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),G=function(){var t=(0,b.default)(g.default.mark(function t(e){var r,n,a,o=e.id,c=void 0===o?"":o,u=e.filePath,i=void 0===u?"":u,s=e.size,d=void 0===s?"":s,p=e.etag,f=void 0===p?"":p;return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r="headportrait?id="+c,""!==d&&(r=r+"&size="+d),n={},""!==f&&(n={etag:f}),t.next=6,T({path:r,header:n});case 6:return a=t.sent,a.auth_mode=0,a.filePath=i,t.abrupt("return",a);case 10:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),M=function(){var t=(0,b.default)(g.default.mark(function t(e){var r,n,a;return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(coreAccount.getLoginModel().isSupportAS){t.next=3;break}return w.info("this enviroment is not supported."),t.abrupt("return",null);case 3:return t.next=5,new coreHttp.hwTupHttpTransSdk;case 5:return r=t.sent,t.next=8,r.sendSyncRequest(e);case 8:if(n=t.sent){t.next=12;break}return w.error("Eua Request Failed, invalid response."),t.abrupt("return",null);case 12:if(n.hasOwnProperty("result")&&0===n.result){t.next=15;break}return w.error("Eua Request Failed, result: "+(n.result?n.result:"Unknown Reason.")),t.abrupt("return",null);case 15:if(!n.hasOwnProperty("param")||!n.param.hasOwnProperty("resp_code")){t.next=30;break}if(304!==n.param.resp_code&&200!==n.param.resp_code){t.next=20;break}w.info("Eua Request Succeed, rsp: "+n.param.resp_code),t.next=28;break;case 20:if(401!==n.param.resp_code){t.next=26;break}return E(),w.error("Eua Request Failed, rsp: "+n.param.resp_code),t.abrupt("return",null);case 26:return w.error("Eua Request Failed, rsp: "+n.param.resp_code),t.abrupt("return",null);case 28:t.next=32;break;case 30:return w.error("Eua Request Failed, rsp: missing param or resp_code."),t.abrupt("return",null);case 32:if(n.param.hasOwnProperty("recv_body")&&n.param.recv_body){t.next=35;break}return w.info("Eua Request Failed, recv_body is null."),t.abrupt("return",null);case 35:if(a=JSON.parse(n.param.recv_body),w.info("Eua Request requestId: ",a.requestId,", Result: "+a.returnMessage.split(".").pop()),"000000000"===a.returnCode){t.next=39;break}return t.abrupt("return",null);case 39:return w.info("Eua Request Succeed."),t.abrupt("return",a.data||!0);case 41:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),P=function(t){function e(){var t,r,n,a,c=this;(0,s.default)(this,e);for(var i=arguments.length,d=Array(i),f=0;f<i;f++)d[f]=arguments[f];return r=n=(0,p.default)(this,(t=e.__proto__||(0,u.default)(e)).call.apply(t,[this].concat(d))),n.eaddrUnint=(0,b.default)(g.default.mark(function t(){return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(L()){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,k.reset();case 4:case"end":return t.stop()}},t,c)})),n.searchAvatar=function(){var t=(0,b.default)(g.default.mark(function t(e){var r,n,a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:constant.AVATAR_SIZE.BIG,u=arguments[2];return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(w.info("searchAvatar"),!coreAccount.getLoginModel().isSupportAS){t.next=9;break}return r=coreCommon.isPc()?window.avatarPath.replaceAll("\\","/"):window.avatarPath,t.next=5,coreContact.syncHeadPortrait(e,""+r+e+".png");case 5:return n=t.sent,t.next=8,coreHttp.httpAsyncResponse.addHandle(n.param.handle,u);case 8:return t.abrupt("return",n);case 9:if(N()){t.next=11;break}return t.abrupt("return",!1);case 11:return t.next=13,k.wait();case 13:return w.debug("searchAvatar",o),a={ServerType:constant.EADDR_SERVER_TYPE.RCS,ucaccount:e,IconSize:o},t.abrupt("return",(new coreTup.HWTupEaddr).then(function(t){return t.setNotifies({196611:u}),t.eaddrSearchAvatar(a).then(function(t){return w.debug("eaddrSearchAvatar"),I(t),t})}));case 16:case"end":return t.stop()}},t,c)}));return function(e){return t.apply(this,arguments)}}(),n.searchAvatarList=function(){var t=(0,b.default)(g.default.mark(function t(e,r){var n;return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(N()){t.next=2;break}return t.abrupt("return",!1);case 2:return t.next=4,k.wait();case 4:return w.info("searchAvatarList begin"),n={ServerType:constant.EADDR_SERVER_TYPE.RCS,ucaccounts:e,IconSize:0},t.abrupt("return",(new coreTup.HWTupEaddr).then(function(t){return t.setNotifies({196616:r}),t.eaddrSearchAvatarList(n).then(function(t){return w.debug("searchAvatarList"),I(t),t})}));case 7:case"end":return t.stop()}},t,c)}));return function(e,r){return t.apply(this,arguments)}}(),n.setAvatar=function(){var t=(0,b.default)(g.default.mark(function t(e,r){var n;return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(w.info("setAvatar"),N()){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,k.wait();case 5:return n={ServerType:3,IconType:1,SmallIconFilePath:e.SmallIconFilePath,MediumIconFilePath:e.MediumIconFilePath,LargeIconFilePath:e.LargeIconFilePath},t.abrupt("return",(new coreTup.HWTupEaddr).then(function(t){return t.setEaddrBaseEvent({upLoadAvatar:function(t){I(t),r(t)}}),t.eaddrSetAvatar(n).then(function(t){return I(t),t})}));case 7:case"end":return t.stop()}},t,c)}));return function(e,r){return t.apply(this,arguments)}}(),n.searchServerContact=function(){var t=(0,b.default)(g.default.mark(function t(){var e,r,n,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments[1],u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(N()){t.next=2;break}return t.abrupt("return",{});case 2:return t.next=4,k.wait();case 4:return w.debug("load ent first time"),w.info("searchServerContact"),a=encodeURIComponent(a),a=""===a?" ":a,e=window.CLIENTCONFIG.EAB_SEARCH_NUM||20,o=o||0,r=parseInt(o/e)+1,n={ServerType:3,condition:a,PageIndex:r,SearchType:u,Dept:""},t.abrupt("return",(new coreTup.HWTupEaddr).then(function(t){return t.eaddrSearchInfo(n).then(function(t){if(I(t)){t.hasOwnProperty("param")&&t.param.hasOwnProperty("entry")&&(t.param.entry=S(t.param.entry));var e=t.param.entry,r=t.param.TotalNum;return w.info("interface server all contacts search finish,count",r),{recordAmount:r,userInformationList:e}}return w.error("searchServerContact failed"),{}})}));case 13:case"end":return t.stop()}},t,c)}));return function(){return t.apply(this,arguments)}}(),n.queryServerContact=function(){var t=(0,b.default)(g.default.mark(function t(e){var r;return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(w.info("queryServerContact"),N()){t.next=3;break}return t.abrupt("return",{param:{}});case 3:return t.next=5,k.wait();case 5:return r={ServerType:3,condition:e,PageIndex:1,SearchType:1,Dept:""},t.abrupt("return",(new coreTup.HWTupEaddr).then(function(t){return t.eaddrSearchInfo(r).then(function(t){return I(t)?(t.hasOwnProperty("param")&&t.param.hasOwnProperty("entry")&&(t.param.entry=S(t.param.entry)),{param:t.param.entry[0],result:t.param.result}):(w.error("queryServerContact failed"),{param:{}})})}));case 7:case"end":return t.stop()}},t,c)}));return function(e){return t.apply(this,arguments)}}(),n.queryUserListFromEaddr=function(){var t=(0,b.default)(g.default.mark(function t(e){var r,a,u,i;return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(w.info("queryUserListFromEaddr"),!(coreAccount.getLoginModel().isSupportAS&&e instanceof Array)){t.next=11;break}return w.info("query user list in cloudusg"),r=e.map(function(t){return{id:t.username}}),t.next=6,n.syncUserDetails(r);case 6:if(!((a=t.sent)instanceof Array&&a.length>0)){t.next=10;break}return u={entry:a,result:0},t.abrupt("return",u);case 10:w.info("query user list in cloudusg failed.");case 11:if(N()){t.next=13;break}return t.abrupt("return");case 13:return t.next=15,k.wait();case 15:return i={users:[].concat((0,o.default)(e))},t.abrupt("return",(new coreTup.HWTupEaddr).then(function(t){return t.eaddrSearchUserList(i).then(function(t){return I(t)?(t.hasOwnProperty("param")&&t.param.hasOwnProperty("entry")&&(t.param.entry=S(t.param.entry)),t.param):(w.error("queryUserListFromEaddr failed"),{})})}));case 17:case"end":return t.stop()}},t,c)}));return function(e){return t.apply(this,arguments)}}(),n.refreshTocken=(0,b.default)(g.default.mark(function t(){return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return w.info("eua refreshToken, just reset eabserverLoginAtomic"),t.abrupt("return",k.reset());case 2:case"end":return t.stop()}},t,c)})),n.getDeptTree=(0,b.default)(g.default.mark(function t(){return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return w.info("euaRequest: before getDeptTree"),t.next=3,n.getDeptList();case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t,c)})),n.getDeptList=function(){var t=(0,b.default)(g.default.mark(function t(){var e,r,n,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return w.info("euaRequest: before getDeptList"),e=""===a?"":"/"+a,r="department"+e,t.next=5,T({path:r});case 5:if(n=t.sent){t.next=8;break}return t.abrupt("return",null);case 8:return t.next=10,M(n);case 10:return t.abrupt("return",t.sent);case 11:case"end":return t.stop()}},t,c)}));return function(){return t.apply(this,arguments)}}(),n.getDeptUserList=function(){var t=(0,b.default)(g.default.mark(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return w.info("euaRequest: before getDeptUserList"),t.next=3,D(e,r,"",n);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t,c)}));return function(){return t.apply(this,arguments)}}(),n.queryDeptUserList=function(){var t=(0,b.default)(g.default.mark(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return w.info("euaRequest: before queryDeptUserList"),t.next=3,D(e,r,n,!0);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t,c)}));return function(){return t.apply(this,arguments)}}(),n.syncUserDetails=function(){var t=(0,b.default)(g.default.mark(function t(){var e,r,n,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(w.info("euaRequest: before syncUserDetails"),!(a instanceof Array&&a.length>0)){t.next=14;break}return t.next=4,U((0,h.default)(a));case 4:if(e=t.sent){t.next=7;break}return t.abrupt("return",null);case 7:return t.next=9,M(e);case 9:if(!((r=t.sent)instanceof Array&&r.length>0)){t.next=14;break}return n=S(r),n.forEach(function(t){t.dept_name=t.deptName,t.dept_name_cn=t.deptName,t.dept_name_en=t.deptName,t.bind_no=t.number,t.mobile=t.phone,t.result_code=constant.EADDR_CONTACT_RESULT_CODE.SUCCESS,delete t.deptName,delete t.number,delete t.phone}),t.abrupt("return",n);case 14:return t.abrupt("return",null);case 15:case"end":return t.stop()}},t,c)}));return function(){return t.apply(this,arguments)}}(),n.syncHeadPortrait=function(){var t=(0,b.default)(g.default.mark(function t(){var e,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"large",u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return w.info("euaRequest: before syncHeadPortrait"),t.next=3,G({id:n,filePath:a,size:o,etag:u});case 3:if(e=t.sent){t.next=6;break}return t.abrupt("return",null);case 6:return t.next=8,new coreHttp.hwTupHttpTransSdk;case 8:return r=t.sent,t.next=11,r.httpDownloadFile(e);case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}},t,c)}));return function(){return t.apply(this,arguments)}}(),n.uploadHeadPortrait=function(){var t=(0,b.default)(g.default.mark(function t(e){var r,n,a=e.id,o=void 0===a?"":a,u=e.filePath,i=void 0===u?"":u;return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return w.info("euaRequest: before uploadHeadPortrait"),t.next=3,G({id:o,filePath:i});case 3:if(r=t.sent){t.next=6;break}return t.abrupt("return",null);case 6:return t.next=8,new coreHttp.hwTupHttpTransSdk;case 8:return n=t.sent,t.next=11,n.httpUploadFile(r);case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}},t,c)}));return function(e){return t.apply(this,arguments)}}(),n.uploadUserInfo=function(){var t=(0,b.default)(g.default.mark(function t(){var e,r,n,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return w.info("euaRequest: before uploadUserInfo"),e="/rest/usg/datacenter/v1/member",r=(0,h.default)(a),t.next=5,T({path:e,body:r});case 5:if(n=t.sent){t.next=8;break}return t.abrupt("return",null);case 8:return n.type=constant.REQUEST_TYPE.PUT,t.next=11,M(n);case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}},t,c)}));return function(){return t.apply(this,arguments)}}(),n.queryFriendsBySearchText=function(){var t=(0,b.default)(g.default.mark(function t(e){var r;return g.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return w.info("queryFriendsBySearchText"),t.next=3,coreDb.queryContactBySearchText(e);case 3:return r=t.sent,isNullOrEmpty(r)||(r=r.filter(function(t){return!isNullOrEmpty(t.contact_id)})),t.abrupt("return",r);case 6:case"end":return t.stop()}},t,c)}));return function(e){return t.apply(this,arguments)}}(),a=r,(0,p.default)(n,a)}return(0,l.default)(e,t),e}(x.default);e.euaserver=new P},2128:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=r(1),o=n(a),c=r(2),u=n(c),i=r(117),s=n(i),d=r(4),p=n(d),f=r(118),l=n(f),v=r(119),h=n(v),m=function(t){function e(){var t,r,n,a,c=this;(0,p.default)(this,e);for(var i=arguments.length,d=Array(i),f=0;f<i;f++)d[f]=arguments[f];return r=n=(0,l.default)(this,(t=e.__proto__||(0,s.default)(e)).call.apply(t,[this].concat(d))),n.eaddrUnint=(0,u.default)(o.default.mark(function t(){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,c)})),n.searchAvatar=function(){var t=(0,u.default)(o.default.mark(function t(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:constant.AVATAR_SIZE.BIG,arguments[2];return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,c)}));return function(e){return t.apply(this,arguments)}}(),n.searchAvatarList=function(){var t=(0,u.default)(o.default.mark(function t(e,r){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,c)}));return function(e,r){return t.apply(this,arguments)}}(),n.setAvatar=function(){var t=(0,u.default)(o.default.mark(function t(e,r){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,c)}));return function(e,r){return t.apply(this,arguments)}}(),n.searchServerContact=function(){var t=(0,u.default)(o.default.mark(function t(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,c)}));return function(){return t.apply(this,arguments)}}(),n.queryServerContact=function(){var t=(0,u.default)(o.default.mark(function t(e){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,c)}));return function(e){return t.apply(this,arguments)}}(),n.queryUserListFromEaddr=function(){var t=(0,u.default)(o.default.mark(function t(e){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,c)}));return function(e){return t.apply(this,arguments)}}(),n.refreshTocken=(0,u.default)(o.default.mark(function t(){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,c)})),n.getDeptTree=(0,u.default)(o.default.mark(function t(){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,c)})),n.getDeptList=function(){var t=(0,u.default)(o.default.mark(function t(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,c)}));return function(){return t.apply(this,arguments)}}(),n.getDeptUserList=function(){var t=(0,u.default)(o.default.mark(function t(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1],!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,c)}));return function(){return t.apply(this,arguments)}}(),n.queryDeptUserList=function(){var t=(0,u.default)(o.default.mark(function t(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,c)}));return function(){return t.apply(this,arguments)}}(),n.syncUserDetails=function(){var t=(0,u.default)(o.default.mark(function t(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,c)}));return function(){return t.apply(this,arguments)}}(),n.syncHeadPortrait=function(){var t=(0,u.default)(o.default.mark(function t(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3];return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,c)}));return function(){return t.apply(this,arguments)}}(),n.uploadHeadPortrait=function(){var t=(0,u.default)(o.default.mark(function t(e){e.id,e.filePath;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,c)}));return function(e){return t.apply(this,arguments)}}(),n.uploadUserInfo=function(){var t=(0,u.default)(o.default.mark(function t(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,c)}));return function(){return t.apply(this,arguments)}}(),n.queryFriendsBySearchText=function(){var t=(0,u.default)(o.default.mark(function t(e){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,c)}));return function(e){return t.apply(this,arguments)}}(),a=r,(0,l.default)(n,a)}return(0,h.default)(e,t),e}(coreCommon.Interface);e.default=m},2129:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}var a=r(1),o=n(a),c=r(2),u=n(c),i=function(){var t=(0,u.default)(o.default.mark(function t(e){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.code){t.next=10;break}t.t0=e.event,t.next="total"===t.t0?4:"uportal"===t.t0?6:9;break;case 4:return window.CLIENTCONFIG.ENABLE_IT_MEETING?coreContact.getDirectoryMenuKeyScroll():(coreContact.loadServerContact(),coreContact.initDepartmentTree(),coreContact.getDirectoryMenuKeyScroll(),coreContact.loadMyContactInfoAndAvatar()),t.abrupt("break",10);case 6:return coreContact.refreshTocken(),(0,d.teLoadContactAndGroupList)(),t.abrupt("break",10);case 9:return t.abrupt("break",10);case 10:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),s=function(){var t=(0,u.default)(o.default.mark(function t(e){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),d=r(1094);window.Logger("contact")("moduleMessager");coreCommon.registeModuleListener("login",i),coreCommon.registeModuleListener("logout",s)},417:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t,e){var r=[];return t.forEach(function(t){isNullOrEmpty(e.query({account:t}))&&r.push({username:t,etag:"fffff"})}),r}function o(t,e){return t.map(function(t){return isNullOrEmpty(t)?{}:e[t]||{}})}function c(t){return t.replace(/(^\s*)|(\s*$)/g,"")}Object.defineProperty(e,"__esModule",{value:!0}),e.addContactToGroups=e.autoCreateGroupName=e.changeGroupName=e.testGroupName=e.initContactGroupNameLogic=e.setContactGroupNameLogic=e.reLoadContactInfo=e.loadMyContactInfoAndAvatar=e.getUserDetail=e.dealUserInfoOprNotify=e.dealUserInfoChange=e.checkIsFriendByAccount=e.createContactOrGroupConversation=e.createConversation=e.createConversationLogic=e.selectAddContactList=e.changeContactGroupName=e.queryContactGroupByOpts=e.addContact=e.checkContactGroupName=e.setAddNewContactValueLogic=e.createNewContactGroup=e.createContactGroup=e.moveToOtherGroup=e.queryContactMemerGroupByOpts=e.deleteContactSubmenu=e.deleteContactFromAll=e.deleteContact=e.deleteContactLogic=e.checkIsFriendByQuery=e.reloadContactListData=e.toggleRemoveFromAll=e.openContactConversationByConf=e.openContactConversation=e.createContactConversation=e.clickContact=e.updateSignatureByRecent=e.updateSignatureFromServer=e.getContactDetailInfo=e.hideGroupAddContacts=e.toggleContactTypeOpen=e.getContactListByAccountList=e.refreshContactInfo=e.getContactByAccount=e.getContactByCallNumber=e.subscribeContactStatus=e.detectContactStatus=e.toggleContactDetailTab=void 0;var u=r(67),i=n(u),s=r(144),d=n(s),p=r(143),f=n(p),l=r(131),v=n(l),h=r(3),m=n(h),g=r(121),C=n(g),b=r(129),y=n(b),x=r(1),w=n(x),_=r(2),k=n(_),I=function(){var t=(0,k.default)(w.default.mark(function t(e){return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(T.length<1)){t.next=2;break}return t.abrupt("return");case 2:coreContact.detectUserStatus({account_list:e});case 3:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),S=function(){var t=(0,k.default)(w.default.mark(function t(e){return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(U.length<1)){t.next=2;break}return t.abrupt("return");case 2:coreContact.subscribeUserStatus({account_list:e});case 3:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),E=(e.refreshContactInfo=function(){var t=(0,k.default)(w.default.mark(function t(e,r){var n,a,o;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,coreIm.checkEServerOnlineNoToast("refreshContactInfo")){t.next=4;break}return O.info("refreshContactInfo 当前尚处于离线状态，不查询服务器"),t.abrupt("return",{});case 4:return n={},t.next=7,(0,L.getUserInfo)(e);case 7:if(a=t.sent,o=a&&a.param,!a||a.result){t.next=15;break}n=(0,C.default)(n,o),coreContact.saveContactInfo(n),X(n,r),t.next=17;break;case 15:return O.error("refreshContactInfo 用户已经不存在"),t.abrupt("return",{});case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(0),O.error("refreshContactInfo",{error:t.t0.toJSON()});case 22:case"end":return t.stop()}},t,this,[[0,19]])}));return function(e,r){return t.apply(this,arguments)}}(),r(683)),L=r(739),N=r(684),O=window.Logger("logic")("contact"),T=(e.toggleContactDetailTab=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:try{r=$getState(),n=r.contactGroups.sliderDetailShow,n?$dispatch(coreUi.updateSliderContactDetailTab(e)):$dispatch(coreUi.updateContactDetailTab(e)),O.info("切换联系人详情tab页","sliderDetailShow:tab:"+e),O.info("切换联系人详情tab页")}catch(t){O.error("toggleContactDetailTab",t)}case 1:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),[]),A=null,D=e.detectContactStatus=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(coreIm.checkEServerOnlineNoToast("detectContactStatus")){t.next=2;break}return t.abrupt("return");case 2:if(!window.CLIENTCONFIG.ENABLE_IT_MEETING){t.next=4;break}return t.abrupt("return");case 4:try{A&&clearInterval(A),r=Object.type(e),n=[],"string"===r?n=[{account:e}]:"array"===r?e.length>0&&(n=e[0].account?e:e.map(function(t){return{account:t}})):"object"===r&&(n=[e]),T=T.concat(n),T.length>20?(I([].concat((0,y.default)(T))),T=[]):A=setTimeout(function(){I([].concat((0,y.default)(T))),T=[]},200)}catch(t){O.error("detectContactStatus",t)}case 5:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),U=[],G=null,M=(e.subscribeContactStatus=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(coreIm.checkEServerOnlineNoToast("subscribeContactStatus")){t.next=2;break}return t.abrupt("return");case 2:try{G&&clearInterval(G),r=Object.type(e),n=[],"string"===r?n=[{account:e}]:"array"===r?e.length>0&&(n=e[0].account?e:e.map(function(t){return{account:t}})):"object"===r&&(n=[e]),U=U.concat(n),U.length>20?(S([].concat((0,y.default)(U))),U=[]):G=setTimeout(function(){S([].concat((0,y.default)(U))),U=[]},200)}catch(t){O.error("detectContactStatus",t)}case 3:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.getContactByCallNumber=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,O.info("getContactByCallNumber begin"),!isNullOrEmpty(e)){t.next=5;break}return O.error("getContactByCallNumber error: callNumber is empty!"),t.abrupt("return","");case 5:return t.next=7,coreDb.queryContactByPhonenumberAccurate(e);case 7:if(r=t.sent,isNullOrEmpty(r)){t.next=11;break}return O.info("getContactByCallNumber has fonded from db!"),t.abrupt("return",r.account);case 11:return t.next=13,coreContact.queryServerContact(e);case 13:if(n=t.sent,n.result!==constant.ERROR_SEARCHINFO_CODE.EADDR_SUCCESS){t.next=21;break}return a=n.param||{},coreUi.getContactAvatar(a.account),coreContact.saveContactInfo(a),t.abrupt("return",a.account);case 21:return t.abrupt("return","");case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(0),O.error("getContactByCallNumber",t.t0);case 27:case"end":return t.stop()}},t,void 0,[[0,24]])}));return function(e){return t.apply(this,arguments)}}(),e.getContactByAccount=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,o,c,u,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=$getState(),n=r.contactGroups.contactUserList,a=r.myInfo,D(e),e!==a.account){t.next=8;break}return s&&coreUi.getContactAvatar(e),t.abrupt("return",a);case 8:if(o=n.query({account:e}),isNullOrEmpty(o)||!o.contact_id){t.next=12;break}return s&&coreUi.getContactAvatar(e),t.abrupt("return",o);case 12:if(isNullOrEmpty(e)){t.next=16;break}return t.next=15,coreDb.queryContact({all:"",accountlist:e});case 15:o=t.sent;case 16:if(o.id&&!s){t.next=30;break}return t.next=19,(0,L.getUserInfo)(e,null,d);case 19:if(c=t.sent,u=c&&c.param,!c||c.result){t.next=28;break}return o=(0,C.default)(o,u),(i||s)&&coreContact.saveContactInfo(o),s&&X(o,r),t.abrupt("return",o);case 28:return O.error("getContactByAccount 用户已经不存在"),t.abrupt("return",{});case 30:return O.info("通过account获取联系人信息","success"),t.abrupt("return",o);case 34:return t.prev=34,t.t0=t.catch(0),O.error("getContactByAccount",t.t0&&t.t0.toString()),t.abrupt("return",{});case 38:case"end":return t.stop()}},t,void 0,[[0,34]])}));return function(e){return t.apply(this,arguments)}}()),P=(e.getContactListByAccountList=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var r=PromiseObject();if(O.info("getContactListByAccountList 通过AccountList获取联系人List"),isNullOrEmpty(t))return O.info("getContactListByAccountList list is empty"),m.default.resolve([]);var n=$getState(),c={};t.forEach(function(t){c[t]||(c[t]=!1)});var u=n.contactGroups.contactUserList,i=n.myInfo,s=[],d=[];if((0,v.default)(c).forEach(function(t){if(isNullOrEmpty(t))c[t]={};else if(!c[t]){var e=void 0;t===i.account?c[t]=i:(e=u.query({account:t}),isNullOrEmpty(e)?s.push(t):c[t]=e,D(t))}}),isNullOrEmpty(s))r.resolve(o(t,c));else{O.info("getContactListByAccountList 查询数据库");var p=s.join(",");O.info("getContactListByAccountList should query from DB:"+s.length),coreDb.queryContactList({all:"",accountlist:p}).then(function(n){if(O.info("getContactListByAccountList DB 查到的联系人:"+n.length),n.forEach(function(t){c[t.account]=t}),n.length===s.length)r.resolve(o(t,c));else{O.info("getContactListByAccountList 查询服务器");var u=a(s,n),i=coreAccount.getLoginModel().isSupportAS?200:20;u.splitByNum(i).forEach(function(t){d.push(coreContact.queryUserListFromEaddr(t))}),m.default.all(d).then(function(n){var a=[];n.forEach(function(t){0===t.result&&t.entry.forEach(function(t){t.result_code===constant.EADDR_CONTACT_RESULT_CODE.SUCCESS&&(a.push(t),c[t.account]=t)})}),e&&(O.info("getContactListByAccountList 保存服务器查到的联系人:"+a.length),coreContact.saveContactInfoList(a)),r.resolve(o(t,c))})}})}return r}catch(t){return O.error("getContactListByAccountList",{error:t.toJSON()}),m.default.resolve([])}},e.toggleContactTypeOpen=function(){var t=(0,k.default)(w.default.mark(function t(e,r){var n,a,o,c;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,n=$getState(),a=n.contactGroups.contactTypeOpen,o=[].concat((0,y.default)(a)),c=0;case 5:if(!(c<o.length)){t.next=12;break}if(o[c].group!==e){t.next=9;break}return o[c].open=r,t.abrupt("break",12);case 9:c++,t.next=5;break;case 12:return t.next=14,$dispatch(coreUi.updateContactTypeOpen(o));case 14:O.info("切换联系人分组折叠展开"),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(0),O.error("toggleContactTypeOpen",t.t0);case 20:case"end":return t.stop()}},t,void 0,[[0,17]])}));return function(e,r){return t.apply(this,arguments)}}(),e.hideGroupAddContacts=function(){coreUi.hideModal()},e.getContactDetailInfo=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,o,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=!0,n={},a={},!isNullOrEmpty(e.account)){t.next=8;break}n=e,t.next=19;break;case 8:if(!e.account){t.next=16;break}return r=!1,o=e.account,t.next=13,M(o,c,c);case 13:a=t.sent,t.next=19;break;case 16:return t.next=18,coreDb.queryContact({contact_id:e.contact_id});case 18:a=t.sent;case 19:return n=isNullOrEmpty(a)?(0,C.default)({},e,{isNotServerInfo:!0}):(0,C.default)({},a,{isNotServerInfo:!1}),O.info("获取联系人详情页信息"),t.abrupt("return",{userInfo:n,customContact:r});case 24:t.prev=24,t.t0=t.catch(0),O.error("getContactDetailInfo",t.t0);case 27:case"end":return t.stop()}},t,void 0,[[0,24]])}));return function(e){return t.apply(this,arguments)}}()),R=(e.updateSignatureFromServer=function(){var t=(0,k.default)(w.default.mark(function t(e,r){var n,a;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(O.info("updateSignatureFromServer"),n=r===$getState().myInfo.account,coreIm.checkEServerOnlineNoToast("updateSignatureFromServer")){t.next=4;break}return t.abrupt("return",e);case 4:return t.next=6,(0,L.getUserInfo)(r);case 6:return a=t.sent,a&&0===a.result&&(R(a,r),e.signature=a.param.signature,n&&$dispatch(coreUi.updateMyInfo(e))),t.abrupt("return",e);case 9:case"end":return t.stop()}},t,void 0)}));return function(e,r){return t.apply(this,arguments)}}(),function(){var t=(0,k.default)(w.default.mark(function t(e,r){var n,a;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(O.info("saveSignatureToDB"),n=$getState().contactGroups.contactUserList,a=n.query({account:r}),isNullOrEmpty(r)){t.next=7;break}return t.next=6,coreDb.queryContact({all:"",accountlist:r});case 6:a=t.sent;case 7:if(isNullOrEmpty(a)||!a.contact_id){t.next=12;break}return t.next=10,coreDb.deleteContact({id:""+a.id});case 10:a.signature=e.param.signature,coreContact.saveContactInfo(a);case 12:case"end":return t.stop()}},t,void 0)}));return function(e,r){return t.apply(this,arguments)}}()),$=(e.updateSignatureByRecent=function(){var t=(0,k.default)(w.default.mark(function t(e){var r;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!isNullOrEmpty(e.contact)&&!isNullOrEmpty(e.contact.account)){t.next=3;break}return O.info("is not contact chat, do not query signature"),t.abrupt("return");case 3:if(O.info("updateSignatureByRecent"),coreIm.checkEServerOnlineNoToast("updateSignatureByRecent")){t.next=6;break}return t.abrupt("return");case 6:if(!window.CLIENTCONFIG.ISMOBILE){t.next=8;break}return t.abrupt("return");case 8:return t.next=10,(0,L.getUserInfo)(e.contact.account);case 10:r=t.sent,r&&0===r.result&&(O.info("update sig-nature in recent",handlePhoneNumber(e.owner)),e.contact.signature=r.param.signature,coreIm.refreshRecentList(e));case 12:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.clickContact=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,o;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=e.contact_id,t.next=4,P(e);case 4:n=t.sent,a=n.userInfo,o=n.customContact,O.info("点击联系人item"),$dispatch(coreUi.updateContactDetail(a,o,r)),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),O.error("clickContact",t.t0);case 14:case"end":return t.stop()}},t,void 0,[[0,11]])}));return function(e){return t.apply(this,arguments)}}(),e.createContactConversation=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,coreIm.createOrUpdateRecent({contact:e},null,n,a);case 3:return r=t.sent,O.info("创建联系人会话"),t.abrupt("return",r);case 8:t.prev=8,t.t0=t.catch(0),O.error("createContactConversation",t.t0);case 11:case"end":return t.stop()}},t,void 0,[[0,8]])}));return function(e){return t.apply(this,arguments)}}()),F=e.openContactConversation=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,o;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=$getState(),n=r.myInfo.account,a=e.account,window.CLIENTCONFIG.USE_IM){t.next=6;break}return t.abrupt("return");case 6:if(!a){t.next=15;break}if(window.CLIENTCONFIG.ISMOBILE){t.next=10;break}return t.next=10,coreCommon.switchNav("recent");case 10:return t.next=12,$(e);case 12:return o=t.sent,isNullOrEmpty(o)?O.error("openContactConversation recent is invalid:",o):(coreIm.openRecentConversation(o),O.info("openContactConversation")),t.abrupt("return",o);case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(0),O.error("openContactConversation error:",t.t0);case 20:case"end":return t.stop()}},t,void 0,[[0,17]])}));return function(e){return t.apply(this,arguments)}}(),B=(e.openContactConversationByConf=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!(r=e.account)){t.next=16;break}if(n=$getState().myInfo.account,r===n){t.next=14;break}return t.next=7,$(e);case 7:if(!(a=t.sent)){t.next=14;break}if(window.CLIENTCONFIG.ISMOBILE){t.next=12;break}return t.next=12,coreCommon.switchNav("recent");case 12:coreIm.toggleRecent(a,o),O.info("openContactConversationByConf 会议中打开联系人会话");case 14:t.next=17;break;case 16:O.info("account is null");case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(0),O.error("openContactConversationByConf",t.t0);case 22:case"end":return t.stop()}},t,void 0,[[0,19]])}));return function(e){return t.apply(this,arguments)}}(),e.toggleRemoveFromAll=function(){var t=(0,k.default)(w.default.mark(function t(e){return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:$dispatch(coreUi.updateRemoveFromAll(e));case 1:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.reloadContactListData=function(){var t=(0,k.default)(w.default.mark(function t(){var e,r,n,a,o,c,u,i,s,d;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,m.default.all([coreDb.queryAllContact(),coreDb.queryAllContactGroupList(),coreDb.queryAllContactMemberGroupList()]);case 3:if(e=t.sent,r=(0,f.default)(e,3),n=r[0],a=r[1],o=r[2],c=n.length>0,u={hasContact:c,contactUserList:n,contactGroup:a,contactMemberGroup:o},O.info("reloadContactListData success, contacGroupIdList = "+a.getKeyArr("group_id")),$dispatch(coreUi.updateContactListData(u)),!window.CLIENTCONFIG.ISMOBILE){t.next=19;break}return t.next=15,(0,N.sortMUserList)(u.contactUserList);case 15:i=t.sent,s=i.mList,d=i.enList,$dispatch(coreUi.updateMobileContactList(s,d));case 19:t.next=24;break;case 21:t.prev=21,t.t0=t.catch(0),O.error("reloadContactListData",t.t0);case 24:case"end":return t.stop()}},t,void 0,[[0,21]])}));return function(){return t.apply(this,arguments)}}()),q=e.checkIsFriendByQuery=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,o;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,O.info("checkIsFriendByQuery 查找联系人分组对应表"),t.next=4,coreDb.queryAllContactMemberGroupList();case 4:r=t.sent,n=!1,a=0;case 7:if(!(a<r.length)){t.next=15;break}if(o=r[a],o.contact_id!==e){t.next=12;break}return n=!0,t.abrupt("break",15);case 12:a++,t.next=7;break;case 15:return t.abrupt("return",n);case 18:return t.prev=18,t.t0=t.catch(0),O.error("checkIsFriendByQuery",t.t0),t.abrupt("return",!1);case 22:case"end":return t.stop()}},t,void 0,[[0,18]])}));return function(e){return t.apply(this,arguments)}}(),H=e.deleteContactLogic=function(){var t=(0,k.default)(w.default.mark(function t(e,r){var n,a,o,c,u;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,E.deleteContactService)(e,r);case 3:if(n=t.sent){t.next=28;break}return t.next=7,coreDb.deleteContactMemberGroup({contact_id:e,group_id:r});case 7:return t.next=9,q(e);case 9:if(a=t.sent){t.next=28;break}return t.next=13,coreDb.queryContact({contact_id:e});case 13:return o=t.sent,c=o.account,o.contact_id="",t.next=18,coreContact.deleteContactFromDB(o);case 18:return t.next=20,coreIm.getLocalRecent({owner:c});case 20:if(u=t.sent,!u.id){t.next=28;break}return u.contact.contact_id="",t.next=25,coreDb.saveRecent(u);case 25:return u=t.sent,t.next=28,$dispatch(coreUi.updateRecent(u));case 28:O.info("删除单个分组里联系人逻辑"),t.next=34;break;case 31:t.prev=31,t.t0=t.catch(0),O.error("deleteContactLogic",t.t0);case 34:case"end":return t.stop()}},t,void 0,[[0,31]])}));return function(e,r){return t.apply(this,arguments)}}(),j=(e.deleteContact=function(){var t=(0,k.default)(w.default.mark(function t(e,r){var n,a;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,H(e,r);case 3:return t.next=5,B();case 5:n=$getState(),a=n.contactGroups.contactInfo.contact_id,e===a&&($dispatch(coreUi.updateSelectedItemKey(-1)),$dispatch(coreUi.updateContactGroupDetailShow("noContent"))),O.info("删除单个分组里联系人"),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),O.error("deleteContact",t.t0);case 14:case"end":return t.stop()}},t,void 0,[[0,11]])}));return function(e,r){return t.apply(this,arguments)}}(),e.deleteContactFromAll=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,o,c,u,i,s,d,p;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,r=$getState(),n=r.contactGroups.contactMemberGroup,a=[].concat((0,y.default)(n)),o=1,c=null,u=0;case 7:if(!(u<a.length)){t.next=23;break}if(e!==a[u].contact_id){t.next=20;break}return c=a[u].group_id,O.info("start to delete friend from contactMemberGroup, contactId : ",e),t.next=13,(0,E.deleteContactService)(e,c);case 13:if(!(o=t.sent)){t.next=18;break}return t.abrupt("break",23);case 18:return t.next=20,coreDb.deleteContactMemberGroup({contact_id:e,group_id:c});case 20:u++,t.next=7;break;case 23:if(o){t.next=44;break}return t.next=26,coreDb.queryContact({contact_id:e});case 26:return i=t.sent,s=i.account,i.contact_id="",t.next=31,coreContact.deleteContactFromDB(i);case 31:return t.next=33,coreIm.getLocalRecent({owner:s});case 33:if(d=t.sent,isNullOrEmpty(d)){t.next=41;break}return d.contact.contact_id="",t.next=38,coreDb.saveRecent(d);case 38:return d=t.sent,t.next=41,$dispatch(coreUi.updateRecent(d));case 41:return t.next=43,B();case 43:window.CLIENTCONFIG.ISMOBILE?i.hasOwnProperty("account")&&!isNullOrEmpty(i.account)?$dispatch(coreUi.updateMobileContactDetail(i,!1)):window.goRoute("main/contactGroups"):(p=r.contactGroups.contactInfo.contact_id,e===p&&($dispatch(coreUi.updateSelectedItemKey(-1)),$dispatch(coreUi.updateContactGroupDetailShow("noContent"))));case 44:O.info("delete friend from all group result:",o),t.next=50;break;case 47:t.prev=47,t.t0=t.catch(0),O.error("deleteContactFromAll",t.t0);case 50:case"end":return t.stop()}},t,void 0,[[0,47]])}));return function(e){return t.apply(this,arguments)}}(),e.deleteContactSubmenu=function(){var t=(0,k.default)(w.default.mark(function t(e,r){var n,a;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,coreIm.checkEserverOnline("deleteContactSubmenu")){t.next=4;break}return O.info("deleteContactSubmenu failed due to offline!"),t.abrupt("return");case 4:if(!(r.length>0)){t.next=13;break}n=0;case 6:if(!(n<r.length)){t.next=13;break}return a=r[n].contact_id,t.next=10,H(a,e);case 10:n++,t.next=6;break;case 13:return t.next=15,(0,E.deleteContactGroupService)(e);case 15:return t.next=17,coreDb.deleteContactGroup({group_id:e});case 17:return t.next=19,B();case 19:O.info("deleteContactSubmenu"),t.next=25;break;case 22:t.prev=22,t.t0=t.catch(0),O.error("deleteContactSubmenu",t.t0);case 25:case"end":return t.stop()}},t,void 0,[[0,22]])}));return function(e,r){return t.apply(this,arguments)}}(),e.queryContactMemerGroupByOpts=function(){var t=(0,k.default)(w.default.mark(function t(e,r){var n,a;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,n=0;case 2:if(!(n<e.length)){t.next=9;break}if(a=e[n],a.contact_id!==r.contact_id||a.group_id!==r.group_id){t.next=6;break}return t.abrupt("return",a);case 6:n++,t.next=2;break;case 9:O.info("queryContactMemerGroupByOpts","success"),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),O.error("queryContactMemerGroupByOpts",t.t0);case 15:case"end":return t.stop()}},t,void 0,[[0,12]])}));return function(e,r){return t.apply(this,arguments)}}()),K=(e.moveToOtherGroup=function(){var t=(0,k.default)(w.default.mark(function t(e,r,n,a,o){var c,u,i,s,d,p,f,l;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,c={contact_id:e,old_group_id:r,new_group_id:n,type:a,uuid:o},t.next=4,(0,E.removeContactToGroupService)(c);case 4:if(u=t.sent,O.info("move friend to other group, result : ",u&&u.result),!(i=0===u.result)){t.next=29;break}if(0!==a){t.next=22;break}return s=$getState(),d=s.contactGroups.contactMemberGroup,t.next=13,j(d,{contact_id:e,group_id:r});case 13:return p=t.sent,p.group_id=n,f=(0,C.default)({},p),t.next=18,coreDb.deleteContactMemberGroup({contact_id:e,group_id:r});case 18:return t.next=20,coreDb.bulkPutContactMemberGroup([f]);case 20:t.next=26;break;case 22:if(1!==a){t.next=26;break}return l={contact_id:e,group_id:n,state:48},t.next=26,coreDb.bulkPutContactMemberGroup([l]);case 26:return t.next=28,B();case 28:return t.abrupt("return",i);case 29:O.info("移动/复制到分组"),t.next=35;break;case 32:t.prev=32,t.t0=t.catch(0),O.error("moveToOtherGroup",t.t0);case 35:case"end":return t.stop()}},t,void 0,[[0,32]])}));return function(e,r,n,a,o){return t.apply(this,arguments)}}(),e.createContactGroup=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,o,c,u,i,s,d;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=$getState(),n=r.common.inputValue,a=n.replace(/\s+/g,""),o=0===a.length?"New Group":n,c=K(o),t.next=8,(0,E.addContactGroupService)(c,e);case 8:if(u=t.sent,u.result){t.next=19;break}return i={group_id:u.param.id,index:-1,name:c,state:0},t.next=13,coreDb.bulkPutContactGroup([i]);case 13:return s=r.contactGroups.contactTypeOpen,d=[].concat((0,y.default)(s)),d.push({group:u.param.id,open:!0}),$dispatch(coreUi.updateContactTypeOpen(d)),t.next=19,B();case 19:return O.info("createContactGroup"),t.abrupt("return",u);case 23:t.prev=23,t.t0=t.catch(0),O.error("createContactGroup",t.t0);case 26:case"end":return t.stop()}},t,void 0,[[0,23]])}));return function(e){return t.apply(this,arguments)}}(),e.createNewContactGroup=function(){var t=(0,k.default)(w.default.mark(function t(){var e,r,n,a,o,c,u,i,s,d,p;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e=$getState(),r=e.contactGroups.addNewName,n=r.replace(/\s+/g,""),!window.CLIENTCONFIG.USE_IM||0!==n.length){t.next=6;break}return t.abrupt("return");case 6:return a=0===n.length?"New Group":r,o=K(a),c=e.contactGroups.contactGroup,u=1,isNullOrEmpty(c)||(u=c[c.length-1].index+1),t.next=13,(0,E.addContactGroupService)(o,u);case 13:if(i=t.sent,i.result){t.next=24;break}return s={group_id:i.param.id,index:u,name:o,isDefault:0,state:0},t.next=18,coreDb.bulkPutContactGroup([s]);case 18:return d=e.contactGroups.contactTypeOpen,p=[].concat((0,y.default)(d)),p.push({group:i.param.id,open:!0}),$dispatch(coreUi.updateContactTypeOpen(p)),t.next=24,B();case 24:return O.info("createNewContactGroup"),t.abrupt("return",i);case 28:t.prev=28,t.t0=t.catch(0),O.error("createNewContactGroup",t.t0);case 31:case"end":return t.stop()}},t,void 0,[[0,28]])}));return function(){return t.apply(this,arguments)}}(),e.setAddNewContactValueLogic=function(t){try{$dispatch(coreUi.setAddNewContactValue(t))}catch(t){O.error("setAddNewContactValue",t)}},e.checkContactGroupName=function(t){try{O.info("checkContactGroupName");var e=c(t),r=[];$getState().contactGroups.contactGroup.map(function(t){r.push(t.name)});if(-1===r.findIndex(function(t){return t===e}))return e;var n=e.length,a=[];r.map(function(t){var r=t.length;if(r>n){var o=t.substr(0,n),c=t.substr(n+1,1),u=t.substr(r-1,1),i=parseInt(t.substr(n+2,r-n-3));o===e&&i&&"number"==typeof i&&"["===c&&"]"===u&&a.push(i)}});for(var o=0===a.length?0:Math.max.apply(Math,a),u=1;u<o+2;u++){var i=function(t){if(-1===a.findIndex(function(e){return e===t}))return{v:e+" ["+t+"]"}}(u);if("object"===(void 0===i?"undefined":(0,d.default)(i)))return i.v}}catch(t){O.error("checkContactGroupName",t)}}),V=(e.addContact=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,o,c,u,i,s,d,p,f,l,v,h,m,g,C,b,y;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=$getState(),n=parseInt(window.CLIENTCONFIG["Device.ComCfg.IM.MaxContact"]),!((a=r.contactGroups.contactUserList?r.contactGroups.contactUserList.length:0)>=n)){t.next=7;break}return alert(language.ADD_TO_MAX),t.abrupt("return");case 7:if(o=e.account,c=e.groupId,u=e.displayName,i={account:o,group_id:c,display_name:void 0===u?"":u},s=void 0,window.CLIENTCONFIG.USE_IM||-3===c){t.next=14;break}s={result:0,param:{contact_id:parseInt((new Date).getTime().toString().substring(5))}},t.next=17;break;case 14:return t.next=16,(0,E.addContactService)(i);case 16:s=t.sent;case 17:if(d=s.param.contact_id,s.result){t.next=50;break}return t.next=21,M(o);case 21:return p=t.sent,p.contact_id=d,t.next=25,(0,L.deleteContactPreSave)(o);case 25:return t.next=27,coreContact.saveContactInfo(p);case 27:return p=t.sent,f={contact_id:d,group_id:c,state:48},t.next=31,coreDb.bulkPutContactMemberGroup([f]);case 31:return t.next=33,B();case 33:return t.next=35,coreIm.getLocalRecent({owner:o});case 35:if(l=t.sent,v=r.contactGroups,h=v.detailContent,m=v.contactInfo,g=v.sliderDetailShow,C=v.sliderContent,b=v.sliderContactInfo,!g||"Contact"!==C||b.account!==o){t.next=41;break}return y=r.contactGroups.sliderAllowBack,t.next=41,$dispatch(coreUi.updateSliderContactDetail(p,!1,y));case 41:if("contact"!==h||m.account!==p.account&&m.contact_id!==p.contact_id||$dispatch(coreUi.updateContactDetail(p,!1)),window.CLIENTCONFIG.ISMOBILE&&$dispatch(coreUi.updateMobileContactDetail(p,!1)),!l.id){t.next=50;break}return l.contact.contact_id=d,t.next=47,coreDb.saveRecent(l);case 47:return l=t.sent,t.next=50,$dispatch(coreUi.updateRecent(l));case 50:return O.info("addContact"),t.abrupt("return",s.result);case 54:t.prev=54,t.t0=t.catch(0),O.error("addContact",t.t0);case 57:case"end":return t.stop()}},t,void 0,[[0,54]])}));return function(e){return t.apply(this,arguments)}}(),e.queryContactGroupByOpts=function(){var t=(0,k.default)(w.default.mark(function t(e,r){var n,a;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=0;case 1:if(!(n<e.length)){t.next=8;break}if(a=e[n],a.group_id!==r.group_id){t.next=5;break}return t.abrupt("return",a);case 5:n++,t.next=1;break;case 8:case"end":return t.stop()}},t,void 0)}));return function(e,r){return t.apply(this,arguments)}}()),W=e.changeContactGroupName=function(){var t=(0,k.default)(w.default.mark(function t(e,r,n){var a,o,c,u,i,s;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=K(r),t.next=4,(0,E.modifyContactGroupName)(e,a,n);case 4:if(o=t.sent,0!==(c=o.result)){t.next=19;break}return u=$getState(),i=u.contactGroups.contactGroup,t.next=11,V(i,{group_id:e});case 11:return s=t.sent,s.name=a,t.next=15,coreDb.deleteContactGroup({group_id:e});case 15:return t.next=17,coreDb.bulkPutContactGroup([s]);case 17:return t.next=19,B();case 19:O.info("changeContactGroupName"),t.next=25;break;case 22:t.prev=22,t.t0=t.catch(0),O.error("changeContactGroupName",t.t0);case 25:case"end":return t.stop()}},t,void 0,[[0,22]])}));return function(e,r,n){return t.apply(this,arguments)}}(),J=(e.selectAddContactList=function(){var t=(0,k.default)(w.default.mark(function t(e){return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:try{O.info("selectAddContactList"),$dispatch(coreUi.updateSelectedContactGroupId(e))}catch(t){O.error("selectAddContactList",t)}case 1:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.createConversationLogic=function(){if(!coreIm.checkEserverOnline("createConversationLogic"))return void O.info("createConversationLogic  Offline not allow");var t=$getState(),e=t.recent.currentRecentInfo;return J(e.contact)},e.createConversation=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,o,c;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,$dispatch(coreUi.setCreateLoading()),r=$getState(),n=void 0,n=r.selectBox.selectBox_tempSelectedList,a=r.myInfo,isNullOrEmpty(e)){t.next=20;break}if(1!==n.length){t.next=20;break}if(n[0].account!==e.account){t.next=15;break}return window.alert(language.CONTACT_ALREADY_EXISTS),t.next=12,$dispatch(coreUi.setCreateNotLoading());case 12:return t.abrupt("return");case 15:if(n[0].account!==a.account){t.next=20;break}return window.alert(language.CAN_NOT_ADD_OWN_ACCOUNT),t.next=19,$dispatch(coreUi.setCreateNotLoading());case 19:return t.abrupt("return");case 20:return o=n.findIndex(function(t){return t.account===a.account}),-1!==o&&n.splice(o,1),e&&e.account!==a.account&&n.unshift(e),t.next=25,z(Y(n));case 25:return c=t.sent,t.next=28,$dispatch(coreUi.setCreateNotLoading());case 28:if(!1!==c){t.next=30;break}return t.abrupt("return");case 30:coreUi.hideModal(),O.info("createConversationLogic","success"),t.next=37;break;case 34:t.prev=34,t.t0=t.catch(0),O.error("createConversationLogic",t.t0);case 37:case"end":return t.stop()}},t,void 0,[[0,34]])}));return function(e){return t.apply(this,arguments)}}()),Y=function(t){for(var e=[],r=0,n=t.length;r<n;r++){for(var a=r+1;a<n;a++)t[r].account===t[a].account&&(a=++r);e.push(t[r])}return e},z=e.createContactOrGroupConversation=function(){var t=(0,k.default)(w.default.mark(function t(e){var r;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(coreIm.checkEserverOnline("createContactOrGroupConversation")){t.next=3;break}return O.info("createContactOrGroupConversation Offline not allow"),t.abrupt("return");case 3:if(0!==e.length){t.next=5;break}return t.abrupt("return");case 5:if(1!==e.length){t.next=9;break}return t.next=8,F(e[0]);case 8:return t.abrupt("return",t.sent);case 9:return t.next=11,coreGroup.createDiscussionGroup({list:e});case 11:if(!((r=t.sent)instanceof Object)){t.next=17;break}return t.next=15,coreIm.openGroupConversation({group_id:r.group_id});case 15:t.next=31;break;case 17:t.t0=r,t.next=1===t.t0?20:32===t.t0?22:35===t.t0?24:29;break;case 20:return window.alert(language.CREAT_FAIL),t.abrupt("break",31);case 22:return window.alert(language.CREATE_GROUP_MAXNUM),t.abrupt("break",31);case 24:return t.next=26,$dispatch(coreUi.setCreateNotLoading());case 26:return coreUi.hideModal(),window.alert(language.CREATE_DISCUSS_MAXNUM),t.abrupt("break",31);case 29:return O.info("createContactOrGroupConversation fail"),t.abrupt("break",31);case 31:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),Q=(e.checkIsFriendByAccount=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,O.info("checkIsFriendByAccount"),r=!1,t.next=5,coreDb.queryContact({account:e});case 5:return n=t.sent,n.contact_id&&(r=!0),t.abrupt("return",r);case 10:t.prev=10,t.t0=t.catch(0),O.error("checkIsFriendByAccount",t.t0);case 13:case"end":return t.stop()}},t,void 0,[[0,10]])}));return function(e){return t.apply(this,arguments)}}(),e.dealUserInfoChange=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,o,c,u,i;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!e.param){t.next=11;break}if(r=$getState(),n=r.myInfo.account,a=e.param.user_list,o=[],!a||!a.length){t.next=11;break}for(c=0;c<a.length;c++)u=a[c],o.push({id:u.account}),i=u.account,n===i&&coreUi.getContactAvatar(i);return t.next=10,Q(o);case 10:O.info("dealUserInfoChange","success");case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(0),O.error("dealUserInfoChange",t.t0);case 16:case"end":return t.stop()}},t,void 0,[[0,13]])}));return function(e){return t.apply(this,arguments)}}(),e.dealUserInfoOprNotify=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,o,c,u;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(t.prev=0,O.info("userInfoOprNotify logic in data = ",(0,i.default)(e.param)),r=e.param.msg_list,n=[],a=[],o=[],c=[],u=0;u<r.length;u++)0===r[u].info_type?2===r[u].opr_type?(O.info("userInfoOprNotify user base info delete logic in"),a.push({id:r[u].user_id,updateTime:r[u].time_stamp})):n.push({id:r[u].user_id,updateTime:r[u].time_stamp}):2===r[u].opr_type?(O.info("userInfoOprNotify user avatar delete logic in"),c.push({id:r[u].user_id,updateTime:r[u].time_stamp})):o.push(r[u].user_id);if(!(n.length>0)){t.next=11;break}return t.next=11,Q(n);case 11:if(!(o.length>0)){t.next=14;break}return t.next=14,coreUi.getContactListAvatar(o);case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(0),O.error("userInfoOprNotify",t.t0);case 19:case"end":return t.stop()}},t,void 0,[[0,16]])}));return function(e){return t.apply(this,arguments)}}(),e.getUserDetail=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,o,c,u,i;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=$getState(),O.debug("result dealuserInfoOpr userDetailAccountList",e),t.next=4,coreContact.syncUserDetails(e);case 4:if(n=t.sent,O.debug("result dealuserInfoOpr",n),!isNullOrEmpty(n)){t.next=8;break}return t.abrupt("return");case 8:a=0;case 9:if(!(a<n.length)){t.next=28;break}if(o=n[a],0!==o.statusCode){t.next=22;break}return t.next=14,coreDb.queryContact({account:o.account});case 14:return c=t.sent,u=(0,C.default)({},c,o),o.account===r.myInfo.account&&$dispatch(coreUi.updateMyInfo(u)),t.next=19,coreContact.saveContactInfo(u);case 19:return i=t.sent,t.next=22,X(i,r);case 22:return t.next=24,B();case 24:O.info("userInfoOprNotify","success");case 25:a++,t.next=9;break;case 28:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}()),X=(e.loadMyContactInfoAndAvatar=function(){var t=(0,k.default)(w.default.mark(function t(){var e,r,n;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(window.CLIENTCONFIG.ENABLE_IT_MEETING||window.CLIENTCONFIG.IS_LINK_IT_SMC_MEETING||window.CLIENTCONFIG.ISBIGWIN)){t.next=3;break}return O.info("IT Meeting plugin or big win, return"),t.abrupt("return");case 3:if(!coreAccount.getLoginModel().isSupportAS){t.next=14;break}return t.next=6,coreDb.queryRecentList({all:""});case 6:for(e=t.sent,r=[],n=0;n<e.length;n++)0!==e[n].chat_type||isNullOrEmpty(e[n].account)||r.push({id:e[n].account});return r=r.slice(0,50),t.next=12,Q(r);case 12:return t.next=14,coreUi.getContactListAvatar(r);case 14:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),e.reLoadContactInfo=function(){var t=(0,k.default)(w.default.mark(function t(e,r){var n,a,o,c,u,i,s,d,p,f,l;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=!0,e.account&&(n=!1),a=r.contactGroups,o=a.detailContent,c=a.contactInfo,u=a.sliderDetailShow,i=a.sliderContent,s=a.sliderContactInfo,d=a.mContactDetailShow,p=a.mContactInfo,!u||"Contact"!==i||s.account!==e.account&&s.contact_id!==e.contact_id||$dispatch(coreUi.updateSliderContactDetail(e,n)),"contact"!==o||c.account!==e.account&&c.contact_id!==e.contact_id||$dispatch(coreUi.updateContactDetail(e,n)),window.CLIENTCONFIG.ISMOBILE&&(!d||p.contact_id!==e.contact_id&&p.account!==e.account||$dispatch(coreUi.updateMobileContactDetail(e,n))),n){t.next=20;break}return f=e.account,t.next=11,coreIm.getLocalRecent({owner:f});case 11:if(l=t.sent,!l.id){t.next=20;break}return l.contact=e,t.next=16,coreDb.saveRecent(l);case 16:if(l=t.sent,l.is_delete!==constant.IS_DELETE.NO){t.next=20;break}return t.next=20,$dispatch(coreUi.updateRecent(l));case 20:O.info("reLoadContactInfo","success"),t.next=26;break;case 23:t.prev=23,t.t0=t.catch(0),O.error("reLoadContactInfo",t.t0);case 26:case"end":return t.stop()}},t,void 0,[[0,23]])}));return function(e,r){return t.apply(this,arguments)}}());e.setContactGroupNameLogic=function(t){$dispatch(coreUi.setContactGroupName(t))},e.initContactGroupNameLogic=function(){$dispatch(coreUi.initContactGroupName())},e.testGroupName=function(t){try{O.info("testGroupName");var e=$getState(),r=e.contactGroups.contactGroupName.trim(),n=e.contactGroups.contactGroup,a=0;return n.map(function(e){e.name===r&&e.group_id!==t&&a++}),0===a}catch(t){O.error("testGroupName",t)}},e.changeGroupName=function(t,e,r){try{O.info("changeGroupName:"),W(t,e,r)}catch(t){O.error("changeGroupName:",t)}},e.autoCreateGroupName=function(t){var e=$getState().contactGroups.contactGroup,r=t.length,n=[];e.map(function(e){var a=e.name.length;if(a>r){var o=e.name.substr(0,r),c=e.name.substr(r+1,1),u=e.name.substr(a-1,1),i=parseInt(e.name.substr(r+2,a-r-3));o===t&&i&&"number"==typeof i&&"["===c&&"]"===u&&n.push(i)}});for(var a=0===n.length?0:Math.max.apply(Math,n),o=1;o<a+2;o++){var c=function(e){if(-1===n.findIndex(function(t){return t===e}))return{v:t+" ["+e+"]"}}(o);if("object"===(void 0===c?"undefined":(0,d.default)(c)))return c.v}},e.addContactToGroups=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,o,c,u,i,s,d,p,f,l,v,h,m,g,C,b,y,x,_,k;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=$getState(),n=void 0,a=parseInt(window.CLIENTCONFIG["Device.ComCfg.IM.MaxContact"]),!((o=r.contactGroups.contactUserList?r.contactGroups.contactUserList.length:0)>=a)){t.next=7;break}return alert(language.ADD_TO_MAX),t.abrupt("return");case 7:c=e.account,u=e.groupList,i=!0,s=void 0,d=0;case 11:if(!(d<u.length)){t.next=37;break}return p=u[d],f=p.group_id,l={account:c,group_id:f,display_name:""},t.next=17,(0,E.addContactService)(l);case 17:if(v=t.sent,s=v.param.contact_id,v.result){t.next=32;break}return t.next=22,M(c);case 22:return n=t.sent,n.contact_id=s,t.next=26,coreContact.saveContactInfo(n);case 26:return n=t.sent,h={contact_id:s,group_id:f,state:48},t.next=30,coreDb.bulkPutContactMemberGroup([h]);case 30:t.next=34;break;case 32:return i=!1,t.abrupt("break",37);case 34:d++,t.next=11;break;case 37:if(!i){t.next=60;break}return t.next=40,B();case 40:return t.next=42,coreIm.getLocalRecent({owner:c});case 42:if(m=t.sent,g=r.contactGroups,C=g.detailContent,b=g.contactInfo,y=g.sliderDetailShow,x=g.sliderContent,_=g.sliderContactInfo,!y||"Contact"!==x||_.account!==c){t.next=47;break}return t.next=47,$dispatch(coreUi.updateSliderContactDetail(n,!1));case 47:if("contact"!==C||b.account!==n.account&&b.contact_id!==s||$dispatch(coreUi.updateContactDetail(n,!1)),!window.CLIENTCONFIG.ISMOBILE){t.next=53;break}return $dispatch(coreUi.updateMobileContactDetail(n,!1)),k={account:c,contact_id:s},t.next=53,(0,N.tapContact)(k);case 53:if(isNullOrEmpty(m)){t.next=60;break}return m.contact.contact_id=s,t.next=57,coreDb.saveRecent(m);case 57:return m=t.sent,t.next=60,$dispatch(coreUi.updateRecent(m));case 60:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}()},67:function(t,e,r){t.exports={default:r(68),__esModule:!0}},68:function(t,e,r){var n=r(8),a=n.JSON||(n.JSON={stringify:JSON.stringify});t.exports=function(t){return a.stringify.apply(a,arguments)}},683:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.getEserverUserInfo=e.subscribeUserStatus=e.detectUserStatus=e.getLinkageStatusLogic=e.setLinkageStatusLogic=e.getFullContactList=e.getContactList=e.confirmPreservateLogic=e.modifyCustomContactService=e.addCustomContactService=e.addContactService=e.modifyContactGroupName=e.addContactGroupService=e.removeContactToGroupService=e.deleteContactGroupService=e.deleteContactService=void 0;var a=r(1),o=n(a),c=r(2),u=n(c),i=window.Logger("logic")("tupLogic"),s=(e.deleteContactService=function(){var t=(0,u.default)(o.default.mark(function t(e,r){var n,a,c,u,s,d;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!window.CLIENTCONFIG.USE_IM){t.next=21;break}if(n=$getState().contactGroups.contactUserList,a="",!coreAccount.getLoginModel().isSupportAS){t.next=12;break}c=0;case 5:if(!(c<n.length)){t.next=12;break}if(e!==n[c].contact_id){t.next=9;break}return a=n[c].account,t.abrupt("break",12);case 9:c++,t.next=5;break;case 12:return t.next=14,new coreTup.HWTupIM;case 14:return u=t.sent,t.next=17,coreAccount.getLoginModel().isSupportAS?u.deleteFriend({self_uuid:$getState().myInfo.account,uuid:a,group_id:r}):u.delfriendorcontact({contact_id:e,group_id:r});case 17:return s=t.sent,d=s.result,i.info("delete friend result : ",d),t.abrupt("return",d);case 21:return t.abrupt("return",0);case 22:case"end":return t.stop()}},t,void 0)}));return function(e,r){return t.apply(this,arguments)}}(),e.deleteContactGroupService=function(){var t=(0,u.default)(o.default.mark(function t(e){var r,n,a;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=!0,!window.CLIENTCONFIG.USE_IM){t.next=9;break}return t.next=4,new coreTup.HWTupIM;case 4:return n=t.sent,t.next=7,n.delusergroup(e);case 7:a=t.sent,r=0===a.result;case 9:return t.next=11,coreDb.deleteContactGroup({group_id:e});case 11:return t.abrupt("return",r);case 12:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.removeContactToGroupService=function(){var t=(0,u.default)(o.default.mark(function t(e){var r,n,a,c,u;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.contact_id,n=e.old_group_id,a=e.new_group_id,c=e.type,!window.CLIENTCONFIG.USE_IM){t.next=10;break}return t.next=4,new coreTup.HWTupIM;case 4:return u=t.sent,t.next=7,u.movecontactgroup(e);case 7:return t.abrupt("return",t.sent);case 10:return t.abrupt("return",{result:0});case 11:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.addContactGroupService=function(){var t=(0,u.default)(o.default.mark(function t(e,r){var n,a,c;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={name:e,index:r},t.next=3,new coreTup.HWTupIM;case 3:return a=t.sent,t.next=6,a.addusergroup(n);case 6:return c=t.sent,t.abrupt("return",c);case 8:case"end":return t.stop()}},t,void 0)}));return function(e,r){return t.apply(this,arguments)}}(),e.modifyContactGroupName=function(){var t=(0,u.default)(o.default.mark(function t(e,r,n){var a,c;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!window.CLIENTCONFIG.USE_IM){t.next=10;break}return t.next=3,new coreTup.HWTupIM;case 3:return a=t.sent,c={id:e,name:r,index:n},t.next=7,a.modusergroup(c);case 7:return t.abrupt("return",t.sent);case 10:return t.abrupt("return",{result:0});case 11:case"end":return t.stop()}},t,void 0)}));return function(e,r,n){return t.apply(this,arguments)}}(),e.addContactService=function(){var t=(0,u.default)(o.default.mark(function t(e){var r,n;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new coreTup.HWTupIM;case 2:return r=t.sent,t.next=5,r.addfriend(e);case 5:return n=t.sent,i.info("add friend result : ",n&&n.result),t.abrupt("return",n);case 8:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.addCustomContactService=function(){var t=(0,u.default)(o.default.mark(function t(e){var r,n;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(window.isEserverOnline){t.next=3;break}return i.error("addCustomContactService eserver is offline!"),t.abrupt("return",{result:1,param:{}});case 3:return t.next=5,new coreTup.HWTupIM;case 5:return r=t.sent,n={id:0,staff_id:0,name:d(e.name),nick_name:"",foreign_name:"",birthday:"",gender:2,corp_name:d(e.crop_name),
//! corp_name 和 crop_name 好坑啊!!!
dept_name:d(e.dept_name),title:d(e.title),mobile:d(e.mobile),office_phone:d(e.office_phone),home_phone:d(e.home_phone),other_phone:d(e.other_phone),fax:d(e.fax),email:d(e.email),website:d(e.website),im_no:d(e.im_no),address:d(e.address),desc:d(e.desc),postcode:d(e.postcode),state:0,other_phone2:d(e.other_phone2),other_mobiles:d(e.other_mobiles),group_id:s(e.group_id)},t.abrupt("return",r.addcontact(n));case 8:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.modifyCustomContactService=function(){var t=(0,u.default)(o.default.mark(function t(e){var r,n;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(window.isEserverOnline){t.next=3;break}return i.error("modifyCustomContactService eserver is offline!"),t.abrupt("return",{result:1,param:{}});case 3:return t.next=5,new coreTup.HWTupIM;case 5:return r=t.sent,n={id:s(e.contact_id),staff_id:s(e.staff_id),name:d(e.name),nick_name:d(e.nick_name),foreign_name:d(e.foreign_name),birthday:d(e.birthday),gender:s(e.gender),corp_name:d(e.crop_name),
//! 设置是corp_name,下发的却是crop_name 好坑啊!!!
dept_name:d(e.dept_name),title:d(e.title),mobile:d(e.mobile),office_phone:d(e.office_phone),home_phone:d(e.home_phone),other_phone:d(e.other_phone),fax:d(e.fax),email:d(e.email),website:d(e.website),im_no:d(e.im_no),address:d(e.address),desc:d(e.desc),postcode:d(e.postcode),state:0,other_phone2:d(e.other_phone2),other_mobiles:d(e.other_mobiles)},t.abrupt("return",r.modcontact(n));case 8:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),function(t){var e="number"===Object.type(t)?t:parseInt(t);return isNaN(e)?0:e}),d=function(t){return isNullOrEmpty(t)||"object"===Object.type(t)?"":t.toString()};e.confirmPreservateLogic=function(){var t=(0,u.default)(o.default.mark(function t(e,r){var n,a,c;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new coreTup.HWTupIM;case 3:return n=t.sent,a={id:e.contact_id,staff_id:e.staff_id,name:e.name,nick_name:r,foreign_name:"11"},t.next=7,n.modcontact(a);case 7:if(c=t.sent,0!==c.result){t.next=13;break}return t.next=11,coreContact.saveContactInfo(e);case 11:t.next=14;break;case 13:window.alert(language.SETTING_NICKNAME_FAILED);case 14:return t.abrupt("return",c);case 17:t.prev=17,t.t0=t.catch(0),i.error("error",t.t0);case 20:case"end":return t.stop()}},t,void 0,[[0,17]])}));return function(e,r){return t.apply(this,arguments)}}(),e.getContactList=function(){var t=(0,u.default)(o.default.mark(function t(){var e,r,n,a;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i.info("getContactList"),coreIm.checkEServerOnlineNoToast("getContactList")){t.next=3;break}return t.abrupt("return",{});case 3:return t.next=5,new coreTup.HWTupIM;case 5:return e=t.sent,t.next=8,coreDb.queryUserConfig({key:"increTimeStamp"});case 8:if(r=t.sent,n=r.value,a=void 0,!isNullOrEmpty(n)){t.next=17;break}return t.next=14,e.getcontactlist({is_sync_all:1,time_stamp:""});case 14:a=t.sent,t.next=20;break;case 17:return t.next=19,e.getcontactlist({is_sync_all:0,time_stamp:n});case 19:a=t.sent;case 20:return a&&a.result===constant.ERROR_CODE.Success&&(i.info("getContactList save time_stamp to localstorage"),coreDb.saveUserConfig({key:"increTimeStamp",value:a.param.time_stamp})),t.abrupt("return",a);case 22:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),e.getFullContactList=function(){var t=(0,u.default)(o.default.mark(function t(){var e,r;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i.info("getFullContactList"),t.next=4,new coreTup.HWTupIM;case 4:return e=t.sent,t.next=7,e.getcontactlist({is_sync_all:1,time_stamp:""});case 7:return r=t.sent,t.abrupt("return",r);case 11:t.prev=11,t.t0=t.catch(0),i.error("getFullContactList",t.t0.toString());case 14:case"end":return t.stop()}},t,void 0,[[0,11]])}));return function(){return t.apply(this,arguments)}}(),e.setLinkageStatusLogic=function(){var t=(0,u.default)(o.default.mark(function t(e){var r;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i.info("setLinkageStatusLogic"),t.next=4,new coreTup.HWTupIM;case 4:return r=t.sent,t.abrupt("return",r.setLinkageStatus(e));case 8:t.prev=8,t.t0=t.catch(0),i.error("setLinkageStatusLogic",t.t0.toString());case 11:case"end":return t.stop()}},t,void 0,[[0,8]])}));return function(e){return t.apply(this,arguments)}}(),e.getLinkageStatusLogic=function(){var t=(0,u.default)(o.default.mark(function t(){var e;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i.info("getLinkageStatusLogic"),t.next=4,new coreTup.HWTupIM;case 4:return e=t.sent,t.abrupt("return",e.getLinkageStatus({}));case 8:t.prev=8,t.t0=t.catch(0),i.error("getLinkageStatusLogic",t.t0.toString());case 11:case"end":return t.stop()}},t,void 0,[[0,8]])}));return function(){return t.apply(this,arguments)}}(),e.detectUserStatus=function(){var t=(0,u.default)(o.default.mark(function t(e){var r,n;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,i.info("detectUserStatus"),coreIm.checkEServerOnlineNoToast("detectUserStatus")){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,new coreTup.HWTupIM;case 6:return r=t.sent,t.next=9,r.detectuserstatus(e);case 9:return n=t.sent,t.abrupt("return",n);case 13:t.prev=13,t.t0=t.catch(0),i.error("detectUserStatus",t.t0.toString());case 16:case"end":return t.stop()}},t,void 0,[[0,13]])}));return function(e){return t.apply(this,arguments)}}(),e.subscribeUserStatus=function(){var t=(0,u.default)(o.default.mark(function t(e){var r,n;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i.info("subscribeUserStatus"),t.next=4,new coreTup.HWTupIM;case 4:return r=t.sent,t.next=7,r.subscribeuserstatus(e);case 7:return n=t.sent,t.abrupt("return",n);case 11:t.prev=11,t.t0=t.catch(0),i.error("subscribeUserStatus",t.t0.toString());case 14:case"end":return t.stop()}},t,void 0,[[0,11]])}));return function(e){return t.apply(this,arguments)}}(),e.getEserverUserInfo=function(){var t=(0,u.default)(o.default.mark(function t(e){var r,n;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i.info("getEserverUserInfo"),t.next=4,new coreTup.HWTupIM;case 4:return r=t.sent,t.next=7,r.getuserinfo(e);case 7:return n=t.sent,t.abrupt("return",n);case 11:t.prev=11,t.t0=t.catch(0),i.error("getEserverUserInfo",t.t0.toString());case 14:case"end":return t.stop()}},t,void 0,[[0,11]])}));return function(e){return t.apply(this,arguments)}}()},684:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.sortMUserListSync=e.sortMUserList=e.tapContact=void 0;var a=r(129),o=n(a),c=r(121),u=n(c),i=r(1),s=n(i),d=r(2),p=n(d),f=r(417),l=(e.tapContact=function(){var t=(0,p.default)(s.default.mark(function t(e){var r,n,a,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=$getState(),n=r.myInfo.account,a=n===e.account,a?window.goRoute("myAccountInfo"):(window.goRoute("contactBasics"),setTimeout(function(){return l(e,o)},10));case 4:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),function(){var t=(0,p.default)(s.default.mark(function t(e){var r,n,a,o,c,i,d,p,l,v,h,m,g;arguments.length>1&&void 0!==arguments[1]&&arguments[1];return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=6;break}return t.next=3,coreDb.queryContact({all:"",accountlist:e.account});case 3:r=t.sent,n=isNullOrEmpty(r)?e:r,$dispatch(coreUi.updateMobileContactDetail(n,isNullOrEmpty(e.account)));case 6:if(!e.contact_id||!isNullOrEmpty(e.account)){t.next=8;break}return t.abrupt("return");case 8:return a=[],o="",t.next=12,(0,f.getContactDetailInfo)(e,!0);case 12:return c=t.sent,i=c.userInfo,d=c.customContact,t.next=17,(0,f.updateSignatureFromServer)(i,e.account);case 17:if(i=t.sent,isNullOrEmpty(i))i=e;else if(i.contact_id){for(p=$getState(),l=p.contactGroups.contactMemberGroup,v=p.contactGroups.contactGroup,h=0;h<l.length;h++)if(l[h].contact_id===i.contact_id)for(m=0;m<v.length;m++)v[m].group_id===l[h].group_id&&a.push(v[m].name);o=a.join(",")}if(g=$getState().contactGroups.contactUserList.query({account:e.account}),$getState().contactGroups.mContactInfo.account===i.account){t.next=22;break}return t.abrupt("return");case 22:$dispatch(coreUi.updateMContactDetailGroup(o)),$dispatch(coreUi.updateMobileContactDetail((0,u.default)({},g,i),d));case 24:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}()),v=(e.sortMUserList=function(){var t=(0,p.default)(s.default.mark(function t(e){return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",v(e));case 1:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.sortMUserListSync=function(t){var e=t.sort(function(){return function(t,e){var r=window.pinyinUtil.getPinyin(t.name),n=window.pinyinUtil.getPinyin(e.name);return r.localeCompare(n)}}()),r=[],n=[],a=[],c=1,u=!1;e.forEach(function(t){var e=window.pinyinUtil.getPinyin(t.name.trim()),o=e.charAt(0).toUpperCase();if(/[a-zA-Z]/.test(o))r.includes(o)||(r.push(o),n.push({type:"charTitle",char:o,char_index:c++})),n.push({type:"charItem",item:t,itemKey:t.contact_id});else{if(u=!0,""===o){var i=getContactName(t);t.q_pin_yin=i}a.push({type:"charItem",item:t,itemKey:t.contact_id})}});var i=[];return u&&(r.push("#"),i=a.sort(function(){return function(t,e){var r=t.item.name,n=e.item.name;return r.localeCompare(n)}}()),i.unshift({type:"charTitle",char:"#",char_index:27})),n.push.apply(n,(0,o.default)(i)),{mList:n,enList:r}})},739:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.preQueryUserListEaddr=e.deleteContactPreSave=e.queryEserverSignature=e.getUserInfo=void 0;var a=r(3),o=n(a),c=r(1),u=n(c),i=r(121),s=n(i),d=r(2),p=n(d),f=window.Logger("contactInterface")("corporateDirectory"),l=(e.getUserInfo=function(){var t=(0,p.default)(u.default.mark(function t(e,r){var n,a,o,c,i,d,p,v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(f.info("getUserInfo,acc:",handleAccountPrint(e)),v&&coreUi.getContactAvatar(e),n=coreAccount.getLoginModel(),a=n.isSupportAS,o={},c={},i={},isNullOrEmpty(r)){t.next=12;break}return t.next=9,coreContact.queryServerContact(r);case 9:i=t.sent,t.next=16;break;case 12:return t.next=14,coreContact.queryUserListFromEaddr([{username:e,etag:"fffff"}]);case 14:d=t.sent,!isNullOrEmpty(d)&&d.entry&&(i={param:d.entry[0],result:d.result});case 16:if(!window.CLIENTCONFIG.USE_IM||a){t.next=20;break}return t.next=19,l(e);case 19:o=t.sent;case 20:return p=a?{}:{image_sync_time:"",modify_time:"",q_pin_yin:"",signature:"",staff_id:"",state:"",age:"",birthday:"",dept_id:"",desc:"",ip_phone:"",is_security:0,old_account:"",other_mobiles:"",voip:""},isNullOrEmpty(o)||isNullOrEmpty(o.param)||(p={image_sync_time:o.param.image_sync_time,modify_time:o.param.modify_time,q_pin_yin:o.param.q_pin_yin,signature:o.param.signature,staff_id:o.param.staff_id,state:o.param.state,age:o.param.age,birthday:o.param.birthday,dept_id:o.param.dept_id,desc:o.param.desc,ip_phone:o.param.ip_phone,is_security:o.param.is_security,old_account:o.param.old_account,other_mobiles:o.param.other_mobiles,voip:o.param.voip}),c=isNullOrEmpty(i)||isNullOrEmpty(i.param)||i.param.result_code!==constant.EADDR_CONTACT_RESULT_CODE.SUCCESS?isNullOrEmpty(o)||isNullOrEmpty(o.param)?(0,s.default)({},{param:{},result:1}):(0,s.default)({},o):(0,s.default)({},i,{param:(0,s.default)({},i.param,p)}),t.abrupt("return",c);case 24:case"end":return t.stop()}},t,void 0)}));return function(e,r){return t.apply(this,arguments)}}(),e.queryEserverSignature=function(){var t=(0,p.default)(u.default.mark(function t(e){var r,n,a,o;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=coreAccount.getLoginModel(),n=r.isSupportAS,a={},o={},!window.CLIENTCONFIG.USE_IM||n){t.next=7;break}return t.next=6,l(e);case 6:a=t.sent;case 7:return isNullOrEmpty(a)||isNullOrEmpty(a.param)?o=(0,s.default)({},{result:1}):o.signature=a.param.signature,t.abrupt("return",o);case 9:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),function(){var t=(0,p.default)(u.default.mark(function t(e){var r;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(coreIm.checkEServerOnlineNoToast("queryEServerFuc")){t.next=2;break}return t.abrupt("return",{param:{}});case 2:return t.next=4,coreContact.getEserverUserInfo({account:e});case 4:if(!(r=t.sent)||!r.param||0!==r.result){t.next=9;break}return t.abrupt("return",{param:r.param,result:r.result});case 9:return f.error("queryEServerFuc search user info failed"),t.abrupt("return",{param:{}});case 11:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}());e.deleteContactPreSave=function(){var t=(0,p.default)(u.default.mark(function t(e){var r,n,a,c;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!isNullOrEmpty(e)){t.next=4;break}return f.info("deleteContactPreSave account is empty"),t.abrupt("return");case 4:return t.next=6,coreDb.queryContactList({all:"",accountlist:e});case 6:if(r=t.sent,n=[],!isNullOrEmpty(r)){t.next=11;break}return f.info("deleteContactPreSave dbResult is empty"),t.abrupt("return");case 11:for(a=0;a<r.length;a++)c=r[a],n.push(coreDb.deleteContact({id:c.id}));return t.next=14,o.default.all(n);case 14:f.info("deleteContactPreSave success,has delete",r.length),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(0),f.error("deleteContactPreSave"+{error:t.t0.toJSON()});case 20:case"end":return t.stop()}},t,void 0,[[0,17]])}));return function(e){return t.apply(this,arguments)}}(),e.preQueryUserListEaddr=function(){var t=(0,p.default)(u.default.mark(function t(e){var r,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!isNullOrEmpty(e)){t.next=3;break}return t.abrupt("return",[]);case 3:if(r=[],!isNullOrEmpty(a)){t.next=9;break}return n=e.getKeyArr("account").join(","),t.next=8,coreDb.queryContactList({all:"",accountlist:n});case 8:a=t.sent;case 9:return e.forEach(function(t){var e=a.query({account:t.account})||{},n={username:t.account,etag:isNullOrEmpty(e.etag)?"fffff":e.etag},o=r.query({username:n.username});isNullOrEmpty(o)&&r.push(n)}),t.abrupt("return",r);case 13:return t.prev=13,t.t0=t.catch(0),f.error("preQueryUserListEaddr error"+{error:t.t0.toJSON()}),t.abrupt("return",[]);case 17:case"end":return t.stop()}},t,void 0,[[0,13]])}));return function(e){return t.apply(this,arguments)}}()}});